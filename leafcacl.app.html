<!DOCTYPE html>

<html lang="es">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Leafcalc - Comparador de Cambio</title>

    

    <link rel="preconnect" href="https://fonts.googleapis.com">

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;700&display=swap" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400&display=swap" rel="stylesheet">

    

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>

        @font-face {

            font-family: 'Heavitas';

            src: url('https://fonts.cdnfonts.com/s/21068/Heavitas.woff') format('woff');

            font-weight: normal;

            font-style: normal;

            font-display: swap;

        }

        

        :root {

            --primary-color: #5c19ae;

            --primary-dark: #4a1588;

            --secondary-color: #f4f4f9;

            --text-color: #333333;

            --background-color: #f4f4f9;

            --card-background: #ffffff;

            --success-color: #00c4aa;

            --error-color: #f44336;

            --border-color: #e0e0e0;

            --shadow: 0 2px 10px rgba(0,0,0,0.1);

            --menu-header: #180a2f;

            --detail-color: #180a2f;

            --saldo-container-bg: #180a2f;

            --saldo-container-text: #f4f4f9;

            --text-on-accent: #f4f4f9;

            --icon-color: #5c19ae;

            --font-primary: 'Nunito', sans-serif;

            --font-secondary: 'Nunito', sans-serif;

            --font-accent: 'Montserrat', sans-serif;

            --font-title: 'Heavitas', sans-serif;

            --saldo-monto-color: #c9a9e1;

            --saldo-decimales-color: #a79ab2;

            --saldo-label-color: #9b8ca5;

            /* Colores para alertas - modo claro */

            --alert-bg-light: #f5f5f5;

            --alert-border-light: #d0d0d0;

            --alert-text-light: #333333;

            --alert-icon-light: #5c19ae;

            --alert-delete-bg-light: #ffebee;

            --alert-delete-text-light: #c62828;

            /* Colores para alertas - modo oscuro */

            --alert-bg-dark: #2a2a3e;

            --alert-border-dark: #3a3a4e;

            --alert-text-dark: #e0e0e0;

            --alert-icon-dark: #9d4edd;

            --alert-delete-bg-dark: #3a1f2f;

            --alert-delete-text-dark: #ef5350;

            /* Colores para el menú lateral */

            --menu-bg: #ffffff;

            --menu-text: #333333;

            --menu-hover: rgba(92, 25, 174, 0.1);

            --menu-border: #e0e0e0;

            --menu-profile-bg: #f4f4f9;

            --menu-profile-text: #180a2f;

        }

        [data-theme="dark"] {

            --primary-color: #5c19ae;

            --primary-dark: #4a1588;

            --secondary-color: #180a2f;

            --text-color: #f4f4f9;

            --background-color: #0b0e13;

            --card-background: #180a2f;

            --success-color: #00c4aa;

            --error-color: #f44336;

            --border-color: #444444;

            --shadow: 0 2px 10px rgba(0,0,0,0.3);

            --menu-header: #180a2f;

            --detail-color: #f4f4f9;

            --saldo-container-bg: #f4f4f9;

            --saldo-container-text: #180a2f;

            --text-on-accent: #f4f4f9;

            --icon-color: #f4f4f9;

            /* Colores para el menú lateral en modo oscuro */

            --menu-bg: #180a2f;

            --menu-text: #f4f4f9;

            --menu-hover: rgba(244, 244, 249, 0.1);

            --menu-border: #444444;

            --menu-profile-bg: #0b0e13;

            --menu-profile-text: #f4f4f9;

        }

        * {

            margin: 0;

            padding: 0;

            box-sizing: border-box;

            font-family: var(--font-primary);

        }

        body {

            background-color: var(--background-color);

            color: var(--text-color);

            padding: 0;

            line-height: 1.6;

            transition: background-color 0.3s, color 0.3s;

            overflow-x: hidden;

        }

        .container {

            max-width: 800px;

            margin: 0 auto;

            padding: 20px;

            min-height: 100vh;

        }

        .header {

            display: flex;

            justify-content: space-between;

            align-items: center;

            margin-bottom: 25px;

            padding-bottom: 15px;

            border-bottom: 1px solid var(--border-color);

        }

        .header h1 {

            color: var(--primary-color);

            font-size: 24px;

            font-family: var(--font-title);

        }

        [data-theme="dark"] .header h1 {

            color: #ffffff;

        }

        .menu-btn, .notification-btn {

            background: none;

            border: none;

            color: var(--icon-color);

            font-size: 22px;

            cursor: pointer;

            padding: 8px;

            border-radius: 50%;

            transition: background-color 0.3s, transform 0.2s ease;

        }

        .menu-btn:hover, .notification-btn:hover {

            background-color: rgba(92, 25, 174, 0.1);

        }

        [data-theme="dark"] .menu-btn:hover, 

        [data-theme="dark"] .notification-btn:hover {

            background-color: rgba(244, 244, 249, 0.1);

        }

        .menu-btn:active, .notification-btn:active {

            transform: scale(0.95);

        }

        .menu-btn:focus, .notification-btn:focus {

            outline: none;

            box-shadow: 0 0 0 2px rgba(92, 25, 174, 0.3);

        }

        

        /* Estilos para campos de monto - Retiro */

        .amount-field {

            width: 100%;

            font-size: 24px;

            border: none;

            border-radius: 0;

            background-color: transparent;

            color: var(--saldo-container-text);

            text-align: center;

            font-family: var(--font-primary);

            font-weight: 500;

            outline: none;

            padding: 0;

            margin: 0;

            box-shadow: none;

            transition: all 0.3s;

        }

        .amount-field::placeholder {

            color: rgba(244, 244, 249, 0.5);

        }

        [data-theme="dark"] .amount-field::placeholder {

            color: rgba(24, 10, 47, 0.5);

        }

        

        /* Estilos para campos de monto - PayPal */

        .calculator-amount-field {

            width: 100%;

            font-size: 24px;

            border: none;

            border-radius: 0;

            background-color: transparent;

            color: var(--saldo-container-text);

            text-align: center;

            font-family: var(--font-primary);

            font-weight: 500;

            outline: none;

            padding: 0;

            margin: 0;

            box-shadow: none;

            transition: all 0.3s;

        }

        .calculator-amount-field::placeholder {

            color: rgba(244, 244, 249, 0.5);

        }

        [data-theme="dark"] .calculator-amount-field::placeholder {

            color: rgba(24, 10, 47, 0.5);

        }

        

        /* Estilos para campos de monto */

        .amount-input-wrapper {

            position: relative;

            margin-bottom: 25px;

        }

        

        .currency-bubble {

            position: absolute;

            top: -12px;

            left: 50%;

            transform: translateX(-50%);

            background-color: #00c4aa;

            color: white;

            padding: 2px 10px;

            border-radius: 12px;

            font-size: 12px;

            font-weight: bold;

            z-index: 1;

            transition: transform 0.2s ease;

        }

        

        .amount-input-container {

            background-color: var(--saldo-container-bg);

            border-radius: 12px;

            padding: 15px 20px;

            margin-bottom: 5px;

            box-shadow: var(--shadow);

            text-align: center;

            transition: transform 0.2s ease;

        }

        

        .amount-input-container h2,

        .amount-input-container h3 {

            margin-bottom: 15px;

            color: var(--saldo-container-text);

            font-size: 20px;

            font-weight: 600;

            font-family: var(--font-secondary);

        }

        

        .input-group {

            position: relative;

            margin-bottom: 15px;

            padding: 0;

        }

        

        .currency-name {

            text-align: center;

            font-size: 14px;

            color: var(--saldo-container-text);

            margin-top: 5px;

            font-family: var(--font-primary);

        }

        

        .error-message {

            color: var(--error-color);

            font-size: 14px;

            margin-top: 5px;

            display: none;

            font-family: var(--font-primary);

        }

        

        /* Estilos para la calculadora de PayPal */

        .paypal-calculator {

            background-color: var(--card-background);

            border-radius: 12px;

            padding: 20px;

            box-shadow: var(--shadow);

            margin-bottom: 20px;

            transition: transform 0.2s ease;

        }

        

        .calculator-section {

            margin-bottom: 25px;

        }

        

        .result-row {

            display: flex;

            justify-content: space-between;

            margin-bottom: 10px;

            padding: 8px 0;

            border-bottom: 1px dashed var(--border-color);

        }

        

        .result-row:last-child {

            border-bottom: none;

        }

        

        .result-label {

            font-weight: 500;

            font-family: var(--font-primary);

        }

        

        .result-value {

            font-weight: bold;

            color: var(--primary-color);

            font-family: var(--font-primary);

        }

        

        .commission-details {

            background-color: var(--background-color);

            border-radius: 8px;

            padding: 15px;

            margin: 15px 0;

        }

        

        .commission-item {

            display: flex;

            justify-content: space-between;

            margin-bottom: 8px;

        }

        

        .commission-item:last-child {

            margin-bottom: 0;

        }

        

        .total-commission {

            color: var(--error-color);

            font-weight: bold;

            font-family: var(--font-primary);

        }

        

        .tabs {

            display: flex;

            margin-bottom: 20px;

            border-bottom: 1px solid var(--border-color);

        }

        

        .tab {

            padding: 12px 20px;

            cursor: pointer;

            border-bottom: 3px solid transparent;

            font-weight: 500;

            transition: all 0.3s;

            display: flex;

            align-items: center;

            font-family: var(--font-secondary);

        }

        

        .tab i {

            margin-right: 8px;

        }

        

        .tab:hover {

            background-color: rgba(92, 25, 174, 0.05);

        }

        

        .tab.active {

            color: var(--primary-color);

            border-bottom-color: var(--primary-color);

        }

        

        .tab-content {

            display: none;

        }

        

        .tab-content.active {

            display: block;

        }

        

        .wallets-container {

            display: grid;

            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));

            gap: 20px;

            margin-bottom: 30px;

        }

        

        .wallet-card {

            background-color: var(--card-background);

            border-radius: 12px;

            padding: 20px;

            box-shadow: var(--shadow);

            transition: transform 0.2s ease, box-shadow 0.2s ease, padding-bottom 0.3s;

            border: 2px solid transparent;

            position: relative;

            padding-top: 25px;

        }

        

        .wallet-card:hover {

            transform: translateY(-3px);

            box-shadow: 0 5px 15px rgba(0,0,0,0.1);

        }

        

        .wallet-card:active {

            transform: translateY(-1px);

        }

        

        .wallet-card.best-option {

            border-color: var(--success-color);

            position: relative;

        }

        

        .wallet-card.best-option::before {

            content: "Mejor opción";

            position: absolute;

            top: -10px;

            right: 15px;

            background-color: var(--success-color);

            color: white;

            padding: 3px 10px;

            border-radius: 20px;

            font-size: 12px;

            font-weight: bold;

            font-family: var(--font-secondary);

        }

        

        .wallet-card.with-alert {

            padding-bottom: 60px;

        }

        

        .wallet-name {

            font-size: 18px;

            font-weight: bold;

            margin-bottom: 5px;

            color: var(--primary-color);

            display: flex;

            align-items: center;

            justify-content: space-between;

            font-family: var(--font-secondary);

        }

        

        .wallet-icon {

            width: 36px;

            height: 36px;

            border-radius: 50%;

            display: flex;

            align-items: center;

            justify-content: center;

            margin-right: 10px;

            font-size: 18px;

            color: white;

            flex-shrink: 0;

            overflow: hidden;

            background-color: #ccc;

        }

        

        .wallet-icon img {

            width: 100%;

            height: 100%;

            object-fit: contain;

        }

        

        .dolarapp-icon {

            background-color: #2E7D32;

        }

        

        .prexarg-icon {

            background-color: #E53935;

        }

        

        .prexuy-icon {

            background-color: #1E88E5;

        }

        

        .paypal-icon {

            background-color: #003087;

        }

        

        .mercadopago-icon {

            background-color: #00B0EA;

        }

        

        .uala-icon {

            background-color: #6A1B9A;

        }

        

        .naranjax-icon {

            background-color: #FF6D00;

        }

        

        .lemon-icon {

            background-color: #FFC107;

        }

        

        .santander-icon {

            background-color: #EC0000;

        }

        

        .belo-icon {

            background-color: #0066CC;

        }

        

        .airtm-icon {

            background-color: #FF5722;

        }

        

        .brubank-icon {

            background-color: #0033A0;

        }

        

        .bna-icon {

            background-color: #00529B;

        }

        

        .icbc-icon {

            background-color: #C7000B;

        }

        

        .galicia-icon {

            background-color: #FFD100;

        }

        

        .wallet-header {

            display: flex;

            align-items: center;

            margin-bottom: 15px;

        }

        

        .wallet-title {

            flex: 1;

        }

        

        .exchange-change {

            font-size: 14px;

            font-weight: normal;

            display: flex;

            align-items: center;

            margin-right: 30px;

        }

        

        .exchange-up {

            color: var(--success-color);

        }

        

        .exchange-down {

            color: var(--error-color);

        }

        

        .wallet-detail {

            display: flex;

            justify-content: space-between;

            margin-bottom: 8px;

        }

        

        .wallet-detail-label {

            color: #888;

            font-family: var(--font-primary);

        }

        

        [data-theme="dark"] .wallet-detail-label {

            color: #cccccc;

        }

        

        .wallet-detail-value {

            font-weight: 500;

            font-family: var(--font-primary);

        }

        

        .net-amount {

            font-size: 20px;

            font-weight: bold;

            color: var(--primary-color);

            margin-top: 10px;

            text-align: center;

            padding-top: 10px;

            border-top: 1px dashed var(--border-color);

            font-family: var(--font-secondary);

        }

        

        .paypal-mode-selector {

            display: flex;

            margin-bottom: 20px;

            background-color: var(--card-background);

            border-radius: 8px;

            overflow: hidden;

            box-shadow: var(--shadow);

        }

        

        .mode-option {

            flex: 1;

            padding: 12px;

            text-align: center;

            cursor: pointer;

            transition: background-color 0.3s;

            font-family: var(--font-secondary);

        }

        

        .mode-option:hover {

            background-color: rgba(92, 25, 174, 0.05);

        }

        

        .mode-option.active {

            background-color: var(--primary-color);

            color: white;

        }

        

        /* Menú Lateral - Mejorado */

        .side-menu {

            position: fixed;

            top: 0;

            left: -80%;

            width: 80%;

            height: 100%;

            background-color: var(--menu-bg);

            box-shadow: 2px 0 10px rgba(0,0,0,0.2);

            z-index: 1000;

            transition: left 0.3s ease;

            overflow-y: auto;

            display: flex;

            flex-direction: column;

        }

        

        .side-menu.open {

            left: 0;

        }

        

        .menu-header {

            background-color: var(--menu-header);

            color: white;

            padding: 25px 20px;

            text-align: center;

            display: flex;

            flex-direction: column;

            align-items: center;

            border-bottom: 1px solid rgba(255, 255, 255, 0.1);

        }

        

        .profile-image-container {

            width: 104px; /* Aumentado en un 15% (90px * 1.15) */

            height: 104px; /* Aumentado en un 15% */

            border-radius: 50%;

            overflow: hidden;

            margin-bottom: 15px;

            cursor: pointer;

            border: 3px solid rgba(255, 255, 255, 0.3);

            transition: transform 0.3s, border-color 0.3s;

            position: relative;

        }

        

        .profile-image-container:hover {

            transform: scale(1.05);

            border-color: rgba(255, 255, 255, 0.6);

        }

        

        .profile-image-container img {

            width: 100%;

            height: 100%;

            object-fit: cover;

        }

        

        .profile-edit-icon {

            position: absolute;

            bottom: -8px; /* Ajustado para el nuevo tamaño */

            right: -8px; /* Ajustado para el nuevo tamaño */

            background-color: var(--primary-color);

            color: white;

            width: 36px; /* Aumentado en un 15% (28px * 1.15) */

            height: 36px; /* Aumentado en un 15% */

            border-radius: 50%;

            display: flex;

            align-items: center;

            justify-content: center;

            font-size: 16px;

            box-shadow: 0 2px 5px rgba(0,0,0,0.2);

            border: 2px solid white;

            z-index: 2;

        }

        

        .menu-header h2 {

            font-size: 22px;

            margin-bottom: 5px;

            font-family: var(--font-title);

            display: flex;

            align-items: center;

            justify-content: center;

        }

        

        .edit-profile-btn-main {

            background-color: rgba(255, 255, 255, 0.2);

            color: white;

            border: none;

            border-radius: 20px;

            padding: 8px 16px;

            font-size: 14px;

            font-weight: 500;

            cursor: pointer;

            display: flex;

            align-items: center;

            justify-content: center;

            transition: background-color 0.3s, transform 0.2s ease;

            margin-top: 10px;

            font-family: var(--font-secondary);

        }

        

        .edit-profile-btn-main:hover {

            background-color: rgba(255, 255, 255, 0.3);

            transform: translateY(-2px);

        }

        

        .edit-profile-btn-main i {

            margin-right: 6px;

        }

        

        .menu-options {

            padding: 20px 0;

            flex: 1;

            display: flex;

            flex-direction: column;

        }

        

        .menu-option {

            display: flex;

            align-items: center;

            padding: 15px 20px;

            cursor: pointer;

            transition: background-color 0.3s;

            font-family: var(--font-primary);

            color: var(--menu-text);

            position: relative;

        }

        

        .menu-option:hover {

            background-color: var(--menu-hover);

        }

        

        .menu-option i {

            margin-right: 15px;

            font-size: 18px;

            color: var(--icon-color);

            width: 20px;

            text-align: center;

        }

        

        [data-theme="dark"] .menu-option i {

            color: var(--text-on-accent);

        }

        

        .menu-option span {

            font-size: 16px;

        }

        

        .menu-separator {

            height: 1px;

            background-color: var(--menu-border);

            margin: 5px 20px;

        }

        

        .menu-footer {

            padding: 15px 20px;

            text-align: center;

            font-size: 12px;

            color: #888;

            border-top: 1px solid var(--menu-border);

            font-family: var(--font-primary);

        }

        

        .overlay {

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background-color: rgba(0,0,0,0.5);

            z-index: 999;

            display: none;

        }

        

        .overlay.active {

            display: block;

        }

        

        /* Panel de Notificaciones */

        .notification-panel {

            display: none;

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background-color: rgba(0,0,0,0.7);

            z-index: 1001;

            align-items: center;

            justify-content: center;

        }

        

        .notification-panel.active {

            display: flex;

        }

        

        .notification-content {

            background-color: var(--card-background);

            border-radius: 12px;

            padding: 25px;

            width: 90%;

            max-width: 500px;

            box-shadow: 0 5px 25px rgba(0,0,0,0.3);

            max-height: 80vh;

            overflow-y: auto;

        }

        

        .notification-header {

            display: flex;

            justify-content: space-between;

            align-items: center;

            margin-bottom: 20px;

            border-bottom: 1px solid var(--border-color);

            padding-bottom: 15px;

        }

        

        .notification-header h2 {

            color: var(--primary-color);

            font-family: var(--font-secondary);

        }

        

        .close-notification {

            background: none;

            border: none;

            font-size: 20px;

            cursor: pointer;

            color: var(--text-color);

            padding: 5px;

            border-radius: 50%;

            transition: background-color 0.3s, transform 0.2s ease;

        }

        

        .close-notification:hover {

            background-color: rgba(0,0,0,0.1);

        }

        

        .close-notification:active {

            transform: scale(0.95);

        }

        

        .notification-item {

            padding: 15px;

            border-bottom: 1px solid var(--border-color);

            display: flex;

            align-items: flex-start;

        }

        

        .notification-item:last-child {

            border-bottom: none;

        }

        

        .notification-icon {

            width: 40px;

            height: 40px;

            border-radius: 50%;

            display: flex;

            align-items: center;

            justify-content: center;

            margin-right: 15px;

            flex-shrink: 0;

            font-size: 18px;

            color: white;

            background-color: #ccc;

            overflow: hidden;

        }

        

        /* Estilos para imágenes dentro de iconos de notificación */

        .notification-icon img {

            width: 100%;

            height: 100%;

            object-fit: contain;

        }

        

        /* Estilos específicos para cada billetera en notificaciones */

        .notification-icon.dolarapp-icon {

            background-color: #2E7D32;

        }

        

        .notification-icon.prexarg-icon {

            background-color: #E53935;

        }

        

        .notification-icon.prexuy-icon {

            background-color: #1E88E5;

        }

        

        .notification-icon.paypal-icon {

            background-color: #003087;

        }

        

        .notification-icon.mercadopago-icon {

            background-color: #00B0EA;

        }

        

        .notification-icon.uala-icon {

            background-color: #6A1B9A;

        }

        

        .notification-icon.naranjax-icon {

            background-color: #FF6D00;

        }

        

        .notification-icon.lemon-icon {

            background-color: #FFC107;

        }

        

        .notification-icon.santander-icon {

            background-color: #EC0000;

        }

        

        .notification-icon.belo-icon {

            background-color: #0066CC;

        }

        

        .notification-icon.airtm-icon {

            background-color: #FF5722;

        }

        

        .notification-icon.brubank-icon {

            background-color: #0033A0;

        }

        

        .notification-icon.bna-icon {

            background-color: #00529B;

        }

        

        .notification-icon.icbc-icon {

            background-color: #C7000B;

        }

        

        .notification-icon.galicia-icon {

            background-color: #FFD100;

        }

        

        .notification-content-wrapper {

            flex: 1;

        }

        

        .notification-title {

            font-weight: bold;

            margin-bottom: 5px;

            font-family: var(--font-secondary);

        }

        

        .notification-subtitle {

            font-size: 14px;

            color: #888;

            margin-bottom: 5px;

            font-family: var(--font-primary);

        }

        

        [data-theme="dark"] .notification-subtitle {

            color: #cccccc;

        }

        

        .notification-time {

            font-size: 12px;

            color: #888;

            font-family: var(--font-primary);

        }

        

        [data-theme="dark"] .notification-time {

            color: #cccccc;

        }

        

        .clear-notifications {

            display: flex;

            align-items: center;

            justify-content: center;

            margin-top: 20px;

            padding-top: 15px;

            border-top: 1px solid var(--border-color);

        }

        

        .clear-notifications-btn {

            display: flex;

            align-items: center;

            justify-content: center;

            background: none;

            border: 1px solid var(--error-color);

            color: var(--error-color);

            padding: 8px 15px;

            border-radius: 6px;

            font-size: 14px;

            cursor: pointer;

            transition: all 0.3s;

            font-family: var(--font-primary);

        }

        

        .clear-notifications-btn:hover {

            background-color: var(--error-color);

            color: white;

        }

        

        .clear-notifications-btn i {

            margin-right: 8px;

        }

        

        /* Panel de Configuración - Mejorado */

        .settings-panel {

            display: none;

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background-color: rgba(0,0,0,0.7);

            z-index: 1001;

            align-items: center;

            justify-content: center;

            overflow-y: auto;

        }

        

        .settings-panel.active {

            display: flex;

        }

        

        .settings-content {

            background-color: var(--card-background);

            border-radius: 12px;

            padding: 0;

            width: 90%;

            max-width: 500px;

            box-shadow: 0 5px 25px rgba(0,0,0,0.3);

            overflow: hidden;

            display: flex;

            flex-direction: column;

            max-height: 90vh;

        }

        

        .settings-header {

            display: flex;

            justify-content: space-between;

            align-items: center;

            padding: 20px 25px;

            border-bottom: 1px solid var(--border-color);

            background-color: var(--primary-color);

            color: white;

            position: sticky;

            top: 0;

            z-index: 10;

        }

        

        .settings-header h2 {

            font-family: var(--font-secondary);

            font-size: 20px;

        }

        

        .close-settings {

            background: none;

            border: none;

            font-size: 20px;

            cursor: pointer;

            color: white;

            padding: 5px;

            border-radius: 50%;

            transition: background-color 0.3s, transform 0.2s ease;

            display: flex;

            align-items: center;

            justify-content: center;

            width: 36px;

            height: 36px;

        }

        

        .close-settings:hover {

            background-color: rgba(255, 255, 255, 0.2);

        }

        

        .close-settings:active {

            transform: scale(0.95);

        }

        

        .settings-body {

            padding: 25px;

            flex: 1;

            overflow-y: auto;

        }

        

        .settings-section {

            margin-bottom: 25px;

            padding-bottom: 20px;

            border-bottom: 1px solid var(--border-color);

        }

        

        .settings-section:last-child {

            margin-bottom: 0;

            padding-bottom: 0;

            border-bottom: none;

        }

        

        .settings-section-title {

            font-size: 16px;

            font-weight: 600;

            margin-bottom: 15px;

            color: var(--primary-color);

            font-family: var(--font-secondary);

            display: flex;

            align-items: center;

        }

        

        .settings-section-title i {

            margin-right: 10px;

            font-size: 18px;

        }

        

        .settings-option {

            margin-bottom: 20px;

        }

        

        .settings-option:last-child {

            margin-bottom: 0;

        }

        

        .settings-option label {

            display: block;

            margin-bottom: 8px;

            font-weight: 500;

            font-family: var(--font-secondary);

            color: var(--text-color);

        }

        

        .settings-option select,

        .settings-option input {

            width: 100%;

            padding: 12px;

            border: 1px solid var(--border-color);

            border-radius: 6px;

            background-color: var(--background-color);

            color: var(--text-color);

            font-family: var(--font-primary);

            transition: border-color 0.3s, box-shadow 0.3s;

        }

        

        .settings-option select:focus,

        .settings-option input:focus {

            outline: none;

            border-color: var(--primary-color);

            box-shadow: 0 0 0 2px rgba(92, 25, 174, 0.2);

        }

        

        .profile-setup {

            display: flex;

            align-items: center;

            gap: 20px;

        }

        

        .profile-image-upload {

            width: 92px; /* Aumentado en un 15% (80px * 1.15) */

            height: 92px; /* Aumentado en un 15% */

            border-radius: 50%;

            overflow: hidden;

            cursor: pointer;

            border: 2px solid var(--border-color);

            position: relative;

            transition: transform 0.3s, border-color 0.3s;

        }

        

        .profile-image-upload:hover {

            transform: scale(1.05);

            border-color: var(--primary-color);

        }

        

        .profile-image-upload img {

            width: 100%;

            height: 100%;

            object-fit: cover;

        }

        

        .profile-image-upload .upload-overlay {

            position: absolute;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background-color: rgba(0, 0, 0, 0.5);

            display: flex;

            align-items: center;

            justify-content: center;

            opacity: 0;

            transition: opacity 0.3s;

        }

        

        .profile-image-upload:hover .upload-overlay {

            opacity: 1;

        }

        

        .profile-image-upload .upload-overlay i {

            color: white;

            font-size: 24px;

        }

        

        .profile-info {

            flex: 1;

        }

        

        .profile-info input {

            width: 100%;

            padding: 10px;

            border: 1px solid var(--border-color);

            border-radius: 6px;

            background-color: var(--background-color);

            color: var(--text-color);

            font-family: var(--font-primary);

        }

        

        .nickname-display {

            display: flex;

            align-items: center;

            justify-content: space-between;

            padding: 10px;

            border: 1px solid var(--border-color);

            border-radius: 6px;

            background-color: var(--background-color);

            margin-bottom: 10px;

        }

        

        .nickname-display span {

            font-size: 16px;

            font-weight: 500;

            font-family: var(--font-primary);

        }

        

        .edit-nickname-btn {

            background: none;

            border: none;

            color: var(--icon-color);

            font-size: 16px;

            cursor: pointer;

            padding: 5px;

            border-radius: 50%;

            transition: background-color 0.3s, transform 0.2s ease;

        }

        

        .edit-nickname-btn:hover {

            background-color: rgba(92, 25, 174, 0.1);

            transform: scale(1.1);

        }

        

        .theme-toggle {

            display: flex;

            align-items: center;

            margin-bottom: 20px;

        }

        

        .toggle-switch {

            position: relative;

            width: 60px;

            height: 30px;

            background-color: #ccc;

            border-radius: 34px;

            margin-left: 15px;

            cursor: pointer;

            transition: background-color 0.3s;

            display: flex;

            align-items: center;

            justify-content: space-between;

            padding: 0 5px;

        }

        

        .toggle-switch.active {

            background-color: var(--primary-color);

        }

        

        .toggle-slider {

            position: absolute;

            top: 3px;

            left: 3px;

            width: 24px;

            height: 24px;

            background-color: white;

            border-radius: 50%;

            transition: transform 0.3s;

            display: flex;

            align-items: center;

            justify-content: center;

            box-shadow: 0 2px 5px rgba(0,0,0,0.2);

        }

        

        .toggle-switch.active .toggle-slider {

            transform: translateX(30px);

        }

        

        .theme-icon {

            font-size: 14px;

            color: #888;

        }

        

        .toggle-switch.active .theme-icon {

            color: white;

        }

        

        .commission-breakdown {

            margin-top: 15px;

            padding-top: 15px;

            border-top: 1px dashed var(--border-color);

        }

        

        .commission-item {

            display: flex;

            justify-content: space-between;

            margin-bottom: 5px;

            font-size: 14px;

        }

        

        .commission-name {

            color: #888;

            font-family: var(--font-primary);

        }

        

        [data-theme="dark"] .commission-name {

            color: #cccccc;

        }

        

        .commission-value {

            font-weight: 500;

            font-family: var(--font-primary);

        }

        

        .footer {

            margin-top: 40px;

            text-align: center;

            color: #888;

            font-size: 14px;

            font-family: var(--font-primary);

        }

        

        [data-theme="dark"] .footer {

            color: #cccccc;

        }

        

        .detail-box {

            background-color: var(--detail-color);

            color: var(--secondary-color);

            padding: 10px;

            border-radius: 8px;

            margin: 10px 0;

        }

        

        /* Estilos para el botón de opciones de la billetera */

        .wallet-options-btn {

            background: none;

            border: none;

            color: var(--icon-color);

            font-size: 18px;

            cursor: pointer;

            padding: 5px;

            border-radius: 50%;

            position: absolute;

            top: 15px;

            right: 15px;

            transition: background-color 0.3s, transform 0.2s ease;

            z-index: 3;

        }

        

        .wallet-options-btn:hover {

            background-color: rgba(92, 25, 174, 0.1);

        }

        

        [data-theme="dark"] .wallet-options-btn:hover {

            background-color: rgba(244, 244, 249, 0.1);

        }

        

        .wallet-options-btn:active {

            transform: scale(0.95);

        }

        

        .wallet-options-btn:focus {

            outline: none;

            box-shadow: 0 0 0 2px rgba(92, 25, 174, 0.3);

        }

        

        /* Menú de opciones de la billetera */

        .wallet-options-menu {

            position: absolute;

            top: 45px;

            right: 15px;

            background-color: var(--card-background);

            border-radius: 8px;

            box-shadow: var(--shadow);

            z-index: 100;

            min-width: 180px;

            display: none;

            overflow: hidden;

        }

        

        .wallet-options-menu.active {

            display: block;

        }

        

        .wallet-option-item {

            display: flex;

            align-items: center;

            padding: 12px 15px;

            cursor: pointer;

            transition: background-color 0.3s;

            font-family: var(--font-primary);

        }

        

        .wallet-option-item:hover {

            background-color: rgba(92, 25, 174, 0.1);

        }

        

        [data-theme="dark"] .wallet-option-item:hover {

            background-color: rgba(244, 244, 249, 0.1);

        }

        

        .wallet-option-item i {

            margin-right: 10px;

            font-size: 16px;

            color: var(--icon-color);

        }

        

        .wallet-option-item span {

            font-size: 14px;

        }

        

        /* Panel de alerta de precio */

        .price-alert-panel {

            display: none;

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background-color: rgba(0,0,0,0.7);

            z-index: 1002;

            align-items: center;

            justify-content: center;

        }

        

        .price-alert-panel.active {

            display: flex;

        }

        

        .price-alert-content {

            background-color: var(--card-background);

            border-radius: 12px;

            padding: 25px;

            width: 90%;

            max-width: 400px;

            box-shadow: 0 5px 25px rgba(0,0,0,0.3);

        }

        

        .price-alert-header {

            display: flex;

            justify-content: space-between;

            align-items: center;

            margin-bottom: 20px;

            border-bottom: 1px solid var(--border-color);

            padding-bottom: 15px;

        }

        

        .price-alert-header h2 {

            color: var(--primary-color);

            font-family: var(--font-secondary);

        }

        

        .close-price-alert {

            background: none;

            border: none;

            font-size: 20px;

            cursor: pointer;

            color: var(--text-color);

            padding: 5px;

            border-radius: 50%;

            transition: background-color 0.3s, transform 0.2s ease;

        }

        

        .close-price-alert:hover {

            background-color: rgba(0,0,0,0.1);

        }

        

        .close-price-alert:active {

            transform: scale(0.95);

        }

        

        .current-rate {

            text-align: center;

            margin-bottom: 20px;

            padding: 15px;

            background-color: var(--background-color);

            border-radius: 8px;

        }

        

        .current-rate-value {

            font-size: 18px;

            font-weight: bold;

            color: var(--success-color);

            margin-bottom: 5px;

            font-family: var(--font-secondary);

        }

        

        .current-rate-change {

            font-size: 14px;

            display: flex;

            align-items: center;

            justify-content: center;

            font-family: var(--font-primary);

        }

        

        .exchange-up {

            color: var(--success-color);

        }

        

        .exchange-down {

            color: var(--error-color);

        }

        

        .alert-type-selector {

            margin-bottom: 20px;

        }

        

        .alert-type-label {

            font-size: 12px;

            color: #888;

            margin-bottom: 5px;

            display: block;

            font-family: var(--font-primary);

        }

        

        .alert-type-options {

            display: flex;

            border: 1px solid var(--border-color);

            border-radius: 6px;

            overflow: hidden;

        }

        

        .alert-type-option {

            flex: 1;

            padding: 12px;

            text-align: center;

            cursor: pointer;

            background-color: var(--background-color);

            transition: background-color 0.3s;

            font-family: var(--font-secondary);

        }

        

        .alert-type-option:hover {

            background-color: rgba(92, 25, 174, 0.05);

        }

        

        .alert-type-option.active {

            background-color: var(--primary-color);

            color: white;

        }

        

        .target-price-input {

            margin-bottom: 20px;

        }

        

        .target-price-label {

            font-size: 12px;

            color: #888;

            margin-bottom: 5px;

            display: block;

            font-family: var(--font-primary);

        }

        

        .currency-input-group {

            display: flex;

            align-items: center;

            border: 1px solid var(--border-color);

            border-radius: 6px;

            overflow: hidden;

        }

        

        .currency-flag {

            width: 40px;

            height: 40px;

            display: flex;

            align-items: center;

            justify-content: center;

            background-color: var(--background-color);

            border-right: 1px solid var(--border-color);

        }

        

        .currency-code {

            padding: 0 10px;

            font-weight: 500;

            font-family: var(--font-primary);

        }

        

        .target-price-field {

            flex: 1;

            border: none;

            background-color: var(--background-color);

            color: var(--text-color);

            padding: 12px;

            font-size: 16px;

            font-family: var(--font-primary);

            transition: border-color 0.3s, box-shadow 0.3s;

        }

        

        .target-price-field:focus {

            outline: none;

            border-color: var(--primary-color);

            box-shadow: 0 0 0 2px rgba(92, 25, 174, 0.2);

        }

        

        .create-alert-btn {

            width: 100%;

            padding: 12px;

            background-color: var(--primary-color);

            color: white;

            border: none;

            border-radius: 6px;

            font-size: 16px;

            font-weight: 500;

            cursor: pointer;

            display: flex;

            align-items: center;

            justify-content: center;

            transition: background-color 0.3s, transform 0.2s ease;

            font-family: var(--font-secondary);

        }

        

        .create-alert-btn:hover {

            background-color: var(--primary-dark);

        }

        

        .create-alert-btn:active {

            transform: scale(0.98);

        }

        

        .create-alert-btn i {

            margin-right: 8px;

        }

        

        /* Alerta activa en la tarjeta de billetera - Mejorada para visibilidad */

        .wallet-alert {

            position: absolute;

            bottom: 15px;

            left: 15px;

            background-color: var(--alert-bg-light);

            border: 1px solid var(--alert-border-light);

            border-radius: 6px;

            padding: 5px 10px;

            font-size: 12px;

            display: flex;

            align-items: center;

            cursor: pointer;

            transition: all 0.3s;

            z-index: 10;

            font-family: var(--font-primary);

            color: var(--alert-text-light);

            box-shadow: 0 2px 5px rgba(0,0,0,0.1);

        }

        

        [data-theme="dark"] .wallet-alert {

            background-color: var(--alert-bg-dark);

            border-color: var(--alert-border-dark);

            color: var(--alert-text-dark);

            box-shadow: 0 2px 8px rgba(0,0,0,0.3);

        }

        

        .wallet-alert i {

            margin-right: 5px;

            color: var(--alert-icon-light);

            font-size: 14px;

        }

        

        [data-theme="dark"] .wallet-alert i {

            color: var(--alert-icon-dark);

        }

        

        .wallet-alert.edit-mode {

            transform: scale(1.05);

            box-shadow: 0 4px 12px rgba(0,0,0,0.2);

        }

        

        [data-theme="dark"] .wallet-alert.edit-mode {

            box-shadow: 0 4px 15px rgba(0,0,0,0.4);

        }

        

        .wallet-alert.edit-mode .alert-actions {

            display: flex;

        }

        

        .alert-actions {

            display: none;

            position: absolute;

            bottom: 100%;

            left: 0;

            width: 100%;

            border-radius: 6px 6px 0 0;

            overflow: hidden;

            box-shadow: 0 -2px 8px rgba(0,0,0,0.15);

        }

        

        [data-theme="dark"] .alert-actions {

            box-shadow: 0 -2px 12px rgba(0,0,0,0.3);

        }

        

        .alert-action {

            flex: 1;

            padding: 8px;

            text-align: center;

            cursor: pointer;

            font-size: 12px;

            font-weight: 500;

            transition: background-color 0.3s;

            font-family: var(--font-primary);

        }

        

        .alert-action.delete {

            background-color: var(--alert-delete-bg-light);

            color: var(--alert-delete-text-light);

        }

        

        [data-theme="dark"] .alert-action.delete {

            background-color: var(--alert-delete-bg-dark);

            color: var(--alert-delete-text-dark);

        }

        

        .alert-action.edit {

            background-color: var(--success-color);

            color: white;

        }

        

        /* Estilos para el campo de monto con símbolo fijo - Diseño actualizado */

        .currency-input-wrapper {

            display: flex;

            align-items: center;

            justify-content: center;

            width: 100%;

            position: relative;

            margin: 0 auto;

            padding: 10px 0;

        }

        

        .currency-amount-container {

            display: flex;

            align-items: flex-start;

            justify-content: center;

            background-color: transparent;

            border: none;

            border-radius: 0;

            width: auto;

            min-width: 200px;

            cursor: text;

            position: relative;

        }

        

        .currency-display {

            display: inline-flex;

            align-items: flex-start;

            font-size: 64px;

            font-weight: bold;

            color: var(--saldo-monto-color);

            position: relative;

        }

        

        .currency-symbol {

            font-size: 64px;

            font-weight: bold;

            color: var(--saldo-monto-color);

            margin-right: 2px;

            line-height: 1;

        }

        

        .integer-part {

            font-size: 64px;

            font-weight: bold;

            color: var(--saldo-monto-color);

            line-height: 1;

        }

        

        .decimal-part {

            font-size: 28px;

            font-weight: normal;

            color: var(--saldo-decimales-color);

            margin-left: 2px;

            margin-top: 8px;

            line-height: 1;

        }

        

        .amount-field-with-symbol {

            position: absolute;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            font-size: 64px;

            border: none;

            border-radius: 0;

            background-color: transparent;

            color: var(--saldo-monto-color);

            text-align: center;

            font-family: var(--font-primary);

            font-weight: bold;

            outline: none;

            padding: 0;

            line-height: 1;

            cursor: text;

            opacity: 0;

            z-index: 2;

        }

        

        .amount-field-with-symbol::placeholder {

            color: rgba(244, 244, 249, 0.5);

        }

        

        [data-theme="dark"] .amount-field-with-symbol::placeholder {

            color: rgba(24, 10, 47, 0.5);

        }

        

        /* Estilo para el contenedor del monto cuando está activo */

        .currency-amount-container.active .currency-display {

            opacity: 0.3;

        }

        

        .currency-amount-container.active .amount-field-with-symbol {

            opacity: 1;

        }

        

        /* Diálogo de confirmación */

        .confirmation-dialog {

            display: none;

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background-color: rgba(0,0,0,0.7);

            z-index: 1003;

            align-items: center;

            justify-content: center;

        }

        

        .confirmation-dialog.active {

            display: flex;

        }

        

        .confirmation-content {

            background-color: var(--card-background);

            border-radius: 12px;

            padding: 25px;

            width: 90%;

            max-width: 400px;

            box-shadow: 0 5px 25px rgba(0,0,0,0.3);

        }

        

        .confirmation-header {

            display: flex;

            justify-content: space-between;

            align-items: center;

            margin-bottom: 20px;

        }

        

        .confirmation-header h2 {

            color: var(--primary-color);

            font-family: var(--font-secondary);

        }

        

        .close-confirmation {

            background: none;

            border: none;

            font-size: 20px;

            cursor: pointer;

            color: var(--text-color);

            padding: 5px;

            border-radius: 50%;

            transition: background-color 0.3s, transform 0.2s ease;

        }

        

        .close-confirmation:hover {

            background-color: rgba(0,0,0,0.1);

        }

        

        .close-confirmation:active {

            transform: scale(0.95);

        }

        

        .confirmation-message {

            margin-bottom: 20px;

            font-family: var(--font-primary);

        }

        

        .confirmation-actions {

            display: flex;

            justify-content: space-between;

        }

        

        .confirmation-btn {

            padding: 10px 20px;

            border: none;

            border-radius: 6px;

            font-size: 16px;

            font-weight: 500;

            cursor: pointer;

            transition: background-color 0.3s, transform 0.2s ease;

            font-family: var(--font-secondary);

        }

        

        .confirmation-btn:active {

            transform: scale(0.98);

        }

        

        .cancel-btn {

            background-color: var(--border-color);

            color: var(--text-color);

        }

        

        .cancel-btn:hover {

            background-color: #ccc;

        }

        

        .confirm-btn {

            background-color: var(--error-color);

            color: white;

        }

        

        .confirm-btn:hover {

            background-color: #d32f2f;

        }

        

        /* Indicador de carga */

        .loading-indicator {

            display: none;

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 3px;

            background-color: var(--primary-color);

            z-index: 1004;

            animation: loading 1s linear infinite;

        }

        

        .loading-indicator.active {

            display: block;

        }

        

        @keyframes loading {

            0% { transform: translateX(-100%); }

            100% { transform: translateX(100%); }

        }

        

        /* Notificación toast para errores */

        .toast {

            position: fixed;

            bottom: 20px;

            left: 50%;

            transform: translateX(-50%) translateY(100px);

            background-color: var(--error-color);

            color: white;

            padding: 12px 20px;

            border-radius: 6px;

            box-shadow: 0 4px 12px rgba(0,0,0,0.15);

            z-index: 1005;

            opacity: 0;

            transition: transform 0.3s ease, opacity 0.3s ease;

            max-width: 80%;

            text-align: center;

        }

        

        .toast.show {

            transform: translateX(-50%) translateY(0);

            opacity: 1;

        }

        

        /* Panel de Datos de Usuario */

        .user-data-panel {

            display: none;

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background-color: rgba(0,0,0,0.7);

            z-index: 1001;

            align-items: center;

            justify-content: center;

            overflow-y: auto;

        }

        

        .user-data-panel.active {

            display: flex;

        }

        

        .user-data-content {

            background-color: var(--card-background);

            border-radius: 12px;

            padding: 0;

            width: 90%;

            max-width: 500px;

            box-shadow: 0 5px 25px rgba(0,0,0,0.3);

            overflow: hidden;

            display: flex;

            flex-direction: column;

            max-height: 90vh;

            margin: 20px 0;

        }

        

        .user-data-header {

            display: flex;

            justify-content: space-between;

            align-items: center;

            padding: 20px 25px;

            border-bottom: 1px solid var(--border-color);

            background-color: var(--primary-color);

            color: white;

            position: sticky;

            top: 0;

            z-index: 10;

        }

        

        .user-data-header h2 {

            font-family: var(--font-secondary);

            font-size: 20px;

        }

        

        .close-user-data {

            background: none;

            border: none;

            font-size: 20px;

            cursor: pointer;

            color: white;

            padding: 5px;

            border-radius: 50%;

            transition: background-color 0.3s, transform 0.2s ease;

            display: flex;

            align-items: center;

            justify-content: center;

            width: 36px;

            height: 36px;

        }

        

        .close-user-data:hover {

            background-color: rgba(255, 255, 255, 0.2);

        }

        

        .close-user-data:active {

            transform: scale(0.95);

        }

        

        .user-data-body {

            padding: 25px;

            flex: 1;

            overflow-y: auto;

        }

        

        .user-data-section {

            margin-bottom: 25px;

            padding-bottom: 20px;

            border-bottom: 1px solid var(--border-color);

        }

        

        .user-data-section:last-child {

            margin-bottom: 0;

            padding-bottom: 0;

            border-bottom: none;

        }

        

        .user-data-section-title {

            font-size: 16px;

            font-weight: 600;

            margin-bottom: 15px;

            color: var(--primary-color);

            font-family: var(--font-secondary);

            display: flex;

            align-items: center;

        }

        

        .user-data-section-title i {

            margin-right: 10px;

            font-size: 18px;

        }

        

        .user-data-option {

            margin-bottom: 20px;

        }

        

        .user-data-option:last-child {

            margin-bottom: 0;

        }

        

        .user-data-option label {

            display: block;

            margin-bottom: 8px;

            font-weight: 500;

            font-family: var(--font-secondary);

            color: var(--text-color);

        }

        

        .user-data-option select,

        .user-data-option input {

            width: 100%;

            padding: 12px;

            border: 1px solid var(--border-color);

            border-radius: 6px;

            background-color: var(--background-color);

            color: var(--text-color);

            font-family: var(--font-primary);

            transition: border-color 0.3s, box-shadow 0.3s;

        }

        

        .user-data-option select:focus,

        .user-data-option input:focus {

            outline: none;

            border-color: var(--primary-color);

            box-shadow: 0 0 0 2px rgba(92, 25, 174, 0.2);

        }

        

        .profile-setup {

            display: flex;

            align-items: center;

            gap: 20px;

        }

        

        .profile-image-upload {

            width: 92px; /* Aumentado en un 15% (80px * 1.15) */

            height: 92px; /* Aumentado en un 15% */

            border-radius: 50%;

            overflow: hidden;

            cursor: pointer;

            border: 2px solid var(--border-color);

            position: relative;

            transition: transform 0.3s, border-color 0.3s;

        }

        

        .profile-image-upload:hover {

            transform: scale(1.05);

            border-color: var(--primary-color);

        }

        

        .profile-image-upload img {

            width: 100%;

            height: 100%;

            object-fit: cover;

        }

        

        .profile-image-upload .upload-overlay {

            position: absolute;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background-color: rgba(0, 0, 0, 0.5);

            display: flex;

            align-items: center;

            justify-content: center;

            opacity: 0;

            transition: opacity 0.3s;

        }

        

        .profile-image-upload:hover .upload-overlay {

            opacity: 1;

        }

        

        .profile-image-upload .upload-overlay i {

            color: white;

            font-size: 24px;

        }

        

        .profile-info {

            flex: 1;

        }

        

        .profile-info input {

            width: 100%;

            padding: 10px;

            border: 1px solid var(--border-color);

            border-radius: 6px;

            background-color: var(--background-color);

            color: var(--text-color);

            font-family: var(--font-primary);

        }

        

        .nickname-display {

            display: flex;

            align-items: center;

            justify-content: space-between;

            padding: 10px;

            border: 1px solid var(--border-color);

            border-radius: 6px;

            background-color: var(--background-color);

            margin-bottom: 10px;

        }

        

        .nickname-display span {

            font-size: 16px;

            font-weight: 500;

            font-family: var(--font-primary);

        }

        

        .edit-nickname-btn {

            background: none;

            border: none;

            color: var(--icon-color);

            font-size: 16px;

            cursor: pointer;

            padding: 5px;

            border-radius: 50%;

            transition: background-color 0.3s, transform 0.2s ease;

        }

        

        .edit-nickname-btn:hover {

            background-color: rgba(92, 25, 174, 0.1);

            transform: scale(1.1);

        }

        

        .user-data-buttons {

            display: flex;

            flex-direction: column;

            gap: 10px;

            margin-top: 20px;

        }

        

        .user-data-button {

            padding: 12px;

            background-color: var(--primary-color);

            color: white;

            border: none;

            border-radius: 6px;

            font-size: 16px;

            font-weight: 500;

            cursor: pointer;

            display: flex;

            align-items: center;

            justify-content: center;

            transition: background-color 0.3s, transform 0.2s ease;

            font-family: var(--font-secondary);

        }

        

        .user-data-button:hover {

            background-color: var(--primary-dark);

        }

        

        .user-data-button:active {

            transform: scale(0.98);

        }

        

        .user-data-button i {

            margin-right: 8px;

        }

        

        .user-data-button.secondary {

            background-color: var(--background-color);

            color: var(--text-color);

            border: 1px solid var(--border-color);

        }

        

        .user-data-button.secondary:hover {

            background-color: rgba(92, 25, 174, 0.05);

        }

        

        /* Panel de Datos Personales */

        .personal-data-panel {

            display: none;

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background-color: rgba(0,0,0,0.7);

            z-index: 1002;

            align-items: center;

            justify-content: center;

            overflow-y: auto;

        }

        

        .personal-data-panel.active {

            display: flex;

        }

        

        .personal-data-content {

            background-color: var(--card-background);

            border-radius: 12px;

            padding: 0;

            width: 90%;

            max-width: 500px;

            box-shadow: 0 5px 25px rgba(0,0,0,0.3);

            overflow: hidden;

            display: flex;

            flex-direction: column;

            max-height: 90vh;

            margin: 20px 0;

        }

        

        .personal-data-header {

            display: flex;

            justify-content: space-between;

            align-items: center;

            padding: 20px 25px;

            border-bottom: 1px solid var(--border-color);

            background-color: var(--primary-color);

            color: white;

            position: sticky;

            top: 0;

            z-index: 10;

        }

        

        .personal-data-header h2 {

            font-family: var(--font-secondary);

            font-size: 20px;

        }

        

        .back-to-user-data {

            background: none;

            border: none;

            font-size: 20px;

            cursor: pointer;

            color: white;

            padding: 5px;

            border-radius: 50%;

            transition: background-color 0.3s, transform 0.2s ease;

            display: flex;

            align-items: center;

            justify-content: center;

            width: 36px;

            height: 36px;

        }

        

        .back-to-user-data:hover {

            background-color: rgba(255, 255, 255, 0.2);

        }

        

        .back-to-user-data:active {

            transform: scale(0.95);

        }

        

        .personal-data-body {

            padding: 25px;

            flex: 1;

            overflow-y: auto;

        }

        

        .personal-data-section {

            margin-bottom: 25px;

            padding-bottom: 20px;

            border-bottom: 1px solid var(--border-color);

        }

        

        .personal-data-section:last-child {

            margin-bottom: 0;

            padding-bottom: 0;

            border-bottom: none;

        }

        

        .personal-data-section-title {

            font-size: 16px;

            font-weight: 600;

            margin-bottom: 15px;

            color: var(--primary-color);

            font-family: var(--font-secondary);

            display: flex;

            align-items: center;

        }

        

        .personal-data-section-title i {

            margin-right: 10px;

            font-size: 18px;

        }

        

        .personal-data-option {

            margin-bottom: 20px;

        }

        

        .personal-data-option:last-child {

            margin-bottom: 0;

        }

        

        .personal-data-option label {

            display: block;

            margin-bottom: 8px;

            font-weight: 500;

            font-family: var(--font-secondary);

            color: var(--text-color);

        }

        

        .personal-data-option input {

            width: 100%;

            padding: 12px;

            border: 1px solid var(--border-color);

            border-radius: 6px;

            background-color: var(--background-color);

            color: var(--text-color);

            font-family: var(--font-primary);

            transition: border-color 0.3s, box-shadow 0.3s;

        }

        

        .personal-data-option input:focus {

            outline: none;

            border-color: var(--primary-color);

            box-shadow: 0 0 0 2px rgba(92, 25, 174, 0.2);

        }

        

        .save-personal-data-btn {

            width: 100%;

            padding: 12px;

            background-color: var(--primary-color);

            color: white;

            border: none;

            border-radius: 6px;

            font-size: 16px;

            font-weight: 500;

            cursor: pointer;

            display: flex;

            align-items: center;

            justify-content: center;

            transition: background-color 0.3s, transform 0.2s ease;

            font-family: var(--font-secondary);

            margin-top: 20px;

        }

        

        .save-personal-data-btn:hover {

            background-color: var(--primary-dark);

        }

        

        .save-personal-data-btn:active {

            transform: scale(0.98);

        }

        

        .save-personal-data-btn i {

            margin-right: 8px;

        }

        

        /* Panel de Personalización de Apariencia */

        .appearance-panel {

            display: none;

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background-color: rgba(0,0,0,0.7);

            z-index: 1002;

            align-items: center;

            justify-content: center;

            overflow-y: auto;

        }

        

        .appearance-panel.active {

            display: flex;

        }

        

        .appearance-content {

            background-color: var(--card-background);

            border-radius: 12px;

            padding: 0;

            width: 90%;

            max-width: 500px;

            box-shadow: 0 5px 25px rgba(0,0,0,0.3);

            overflow: hidden;

            display: flex;

            flex-direction: column;

            max-height: 90vh;

            margin: 20px 0;

        }

        

        .appearance-header {

            display: flex;

            justify-content: space-between;

            align-items: center;

            padding: 20px 25px;

            border-bottom: 1px solid var(--border-color);

            background-color: var(--primary-color);

            color: white;

            position: sticky;

            top: 0;

            z-index: 10;

        }

        

        .appearance-header h2 {

            font-family: var(--font-secondary);

            font-size: 20px;

        }

        

        .close-appearance {

            background: none;

            border: none;

            font-size: 20px;

            cursor: pointer;

            color: white;

            padding: 5px;

            border-radius: 50%;

            transition: background-color 0.3s, transform 0.2s ease;

            display: flex;

            align-items: center;

            justify-content: center;

            width: 36px;

            height: 36px;

        }

        

        .close-appearance:hover {

            background-color: rgba(255, 255, 255, 0.2);

        }

        

        .close-appearance:active {

            transform: scale(0.95);

        }

        

        .appearance-body {

            padding: 25px;

            flex: 1;

            overflow-y: auto;

        }

        

        .appearance-section {

            margin-bottom: 25px;

            padding-bottom: 20px;

            border-bottom: 1px solid var(--border-color);

        }

        

        .appearance-section:last-child {

            margin-bottom: 0;

            padding-bottom: 0;

            border-bottom: none;

        }

        

        .appearance-section-title {

            font-size: 16px;

            font-weight: 600;

            margin-bottom: 15px;

            color: var(--primary-color);

            font-family: var(--font-secondary);

            display: flex;

            align-items: center;

        }

        

        .appearance-section-title i {

            margin-right: 10px;

            font-size: 18px;

        }

        

        .appearance-option {

            margin-bottom: 20px;

        }

        

        .appearance-option:last-child {

            margin-bottom: 0;

        }

        

        .appearance-option label {

            display: block;

            margin-bottom: 8px;

            font-weight: 500;

            font-family: var(--font-secondary);

            color: var(--text-color);

        }

        

        .theme-toggle {

            display: flex;

            align-items: center;

            margin-bottom: 20px;

        }

        

        .toggle-switch {

            position: relative;

            width: 60px;

            height: 30px;

            background-color: #ccc;

            border-radius: 34px;

            margin-left: 15px;

            cursor: pointer;

            transition: background-color 0.3s;

            display: flex;

            align-items: center;

            justify-content: space-between;

            padding: 0 5px;

        }

        

        .toggle-switch.active {

            background-color: var(--primary-color);

        }

        

        .toggle-slider {

            position: absolute;

            top: 3px;

            left: 3px;

            width: 24px;

            height: 24px;

            background-color: white;

            border-radius: 50%;

            transition: transform 0.3s;

            display: flex;

            align-items: center;

            justify-content: center;

            box-shadow: 0 2px 5px rgba(0,0,0,0.2);

        }

        

        .toggle-switch.active .toggle-slider {

            transform: translateX(30px);

        }

        

        .theme-icon {

            font-size: 14px;

            color: #888;

        }

        

        .toggle-switch.active .theme-icon {

            color: white;

        }

        

        .custom-themes {

            display: flex;

            flex-wrap: wrap;

            gap: 15px;

            margin-top: 15px;

        }

        

        .custom-theme {

            width: 100px;

            height: 100px;

            border-radius: 12px;

            overflow: hidden;

            cursor: pointer;

            transition: transform 0.2s ease, box-shadow 0.2s ease;

            position: relative;

        }

        

        .custom-theme:hover {

            transform: translateY(-3px);

            box-shadow: 0 5px 15px rgba(0,0,0,0.1);

        }

        

        .custom-theme-gradient {

            width: 100%;

            height: 70%;

            background: linear-gradient(135deg, #5c19ae, #f4f4f9);

        }

        

        .custom-theme-name {

            width: 100%;

            height: 30%;

            display: flex;

            align-items: center;

            justify-content: center;

            background-color: var(--background-color);

            color: var(--text-color);

            font-size: 12px;

            font-family: var(--font-primary);

        }

        

        .best-options {

            position: absolute;

            top: -10px;

            right: 15px;

            display: flex;

            flex-direction: row;

            gap: 5px;

            z-index: 2;

            max-width: calc(100% - 50px);

            flex-wrap: wrap;

            justify-content: flex-end;

        }

        .best-option-tag {

            background-color: var(--success-color);

            color: white;

            padding: 3px 10px;

            border-radius: 20px;

            font-size: 12px;

            font-weight: bold;

            font-family: var(--font-secondary);

            white-space: nowrap;

        }

        .best-option-tag.sell {

            background-color: var(--primary-color);

        }

        

        /* Estilos para mensajes de estado */

        .status-message {

            background-color: var(--card-background);

            border-radius: 12px;

            padding: 30px;

            text-align: center;

            box-shadow: var(--shadow);

            margin-bottom: 20px;

        }

        

        .status-message i {

            font-size: 48px;

            color: var(--primary-color);

            margin-bottom: 15px;

        }

        

        .status-message h3 {

            margin-bottom: 10px;

            color: var(--text-color);

        }

        

        .status-message p {

            color: var(--text-color);

            opacity: 0.8;

        }

        

        @media (max-width: 768px) {

            .container {

                padding: 15px;

            }

            

            .wallets-container {

                grid-template-columns: 1fr;

            }

            

            .header h1 {

                font-size: 20px;

            }

            

            .settings-content {

                width: 95%;

                padding: 20px;

                max-height: 95vh;

                margin: 10px 0;

            }

            

            .side-menu {

                width: 85%;

                left: -85%;

            }

            

            .profile-setup {

                flex-direction: column;

                text-align: center;

            }

            

            .exchange-change {

                margin-right: 25px;

            }

            

            .wallet-card.with-alert {

                padding-bottom: 70px;

            }

            

            .currency-symbol {

                font-size: 48px;

            }

            

            .integer-part {

                font-size: 48px;

            }

            

            .decimal-part {

                font-size: 24px;

                margin-top: 6px;

            }

            

            .amount-field-with-symbol {

                font-size: 48px;

            }

            

            .currency-display {

                font-size: 48px;

            }

            

            .confirmation-actions {

                flex-direction: column;

                gap: 10px;

            }

            

            .confirmation-btn {

                width: 100%;

            }

            

            .wallet-alert {

                font-size: 11px;

                padding: 4px 8px;

            }

            

            .wallet-alert i {

                font-size: 12px;

            }

            

            .settings-body {

                padding: 20px;

            }

            

            .profile-setup {

                flex-direction: column;

                align-items: center;

                gap: 15px;

            }

            

            .profile-info {

                width: 100%;

            }

            

            .profile-image-container {

                width: 88px; /* Ajustado para móviles */

                height: 88px; /* Ajustado para móviles */

            }

            

            .profile-edit-icon {

                width: 30px; /* Ajustado para móviles */

                height: 30px; /* Ajustado para móviles */

                bottom: -6px; /* Ajustado para móviles */

                right: -6px; /* Ajustado para móviles */

            }

            

            .profile-image-upload {

                width: 78px; /* Ajustado para móviles */

                height: 78px; /* Ajustado para móviles */

            }

            

            .user-data-content,

            .personal-data-content,

            .appearance-content {

                width: 95%;

                padding: 20px;

                max-height: 95vh;

                margin: 10px 0;

            }

            

            .custom-themes {

                justify-content: center;

            }

            

            .best-options {

                max-width: calc(100% - 60px);

            }

        }

    </style>

</head>

<body>

    <div class="container">

        <div class="header">

            <button class="menu-btn" id="menuBtn" aria-label="Abrir menú">

                <i class="fas fa-bars"></i>

            </button>

            <h1>Leafcalc</h1>

            <button class="notification-btn" id="notificationBtn" aria-label="Ver notificaciones">

                <i class="fas fa-bell"></i>

            </button>

        </div>

        

        <div class="tabs">

            <div class="tab active" data-tab="withdraw" role="tab" aria-selected="true">

                <i class="fas fa-heart"></i>

                <span>Retira desde Paypal</span>

            </div>

            <div class="tab" data-tab="paypal" role="tab" aria-selected="false">

                <i class="fab fa-paypal"></i>

                <span>Calcula Pagos y cobros</span>

            </div>

            <div class="tab" data-tab="general" role="tab" aria-selected="false">

                <i class="fas fa-wallet"></i>

                <span>Billeteras</span>

            </div>

        </div>

        

        <div class="tab-content active" id="withdraw-tab" role="tabpanel">

            <div class="amount-input-wrapper">

                <div class="currency-bubble">U$S</div>

                <div class="amount-input-container">

                    <h2>Saldo a retirar</h2>

                    <div class="input-group">

                        <div class="currency-input-wrapper">

                            <div class="currency-amount-container" id="amountContainer">

                                <div class="currency-display" id="amountDisplay">

                                    <span class="currency-symbol">$</span>

                                    <span class="integer-part">0</span>

                                    <span class="decimal-part">,00</span>

                                </div>

                                <input type="text" class="amount-field amount-field-with-symbol" id="amountInput" placeholder="0,00" value="0,00" aria-label="Monto a retirar">

                            </div>

                        </div>

                    </div>

                    <div class="currency-name">Dólares US</div>

                </div>

                <div class="error-message" id="errorMessage" role="alert">Ingrese un monto válido</div>

            </div>

            <div class="wallets-container" id="withdrawContainer">

                </div>

        </div>

        

        <div class="tab-content" id="paypal-tab" role="tabpanel">

            <div class="paypal-mode-selector">

                <div class="mode-option active" data-mode="receive" role="tab" aria-selected="true">Cobrar</div>

                <div class="mode-option" data-mode="send" role="tab" aria-selected="false">Pagar</div>

            </div>

            

            <div class="paypal-calculator">

                <div id="receiveMode" class="calculator-section">

                    <div class="amount-input-wrapper">

                        <div class="currency-bubble">U$S</div>

                        <div class="amount-input-container">

                            <h3>Monto que deseas recibir:</h3>

                            <div class="input-group">

                                <div class="currency-input-wrapper">

                                    <div class="currency-amount-container" id="receiveAmountContainer">

                                        <div class="currency-display" id="receiveAmountDisplay">

                                            <span class="currency-symbol">$</span>

                                            <span class="integer-part">0</span>

                                            <span class="decimal-part">,00</span>

                                        </div>

                                        <input type="text" class="calculator-amount-field amount-field-with-symbol" id="receiveAmount" placeholder="0,00" value="0,00" aria-label="Monto a recibir">

                                    </div>

                                </div>

                            </div>

                            <div class="currency-name">Dólares US</div>

                        </div>

                    </div>

                    

                    <div class="result-row">

                        <span class="result-label">Te deben enviar:</span>

                        <span class="result-value" id="grossReceiveAmount">USD $0,00</span>

                    </div>

                    

                    <div class="commission-details">

                        <h4>Comisiones:</h4>

                        <div class="commission-item">

                            <span>Comisión porcentual (5.4%):</span>

                            <span id="percentCommissionReceive">USD $0,00</span>

                        </div>

                        <div class="commission-item">

                            <span>Comisión fija:</span>

                            <span id="fixedCommissionReceive">USD $0,30</span>

                        </div>

                        <div class="commission-item total-commission">

                            <span>Total de las comisiones:</span>

                            <span id="totalCommissionReceive">USD $0,00</span>

                        </div>

                    </div>

                </div>

                

                <div id="sendMode" class="calculator-section" style="display: none;">

                    <div class="amount-input-wrapper">

                        <div class="currency-bubble">U$S</div>

                        <div class="amount-input-container">

                            <h3>Monto que deseas pagar:</h3>

                            <div class="input-group">

                                <div class="currency-input-wrapper">

                                    <div class="currency-amount-container" id="sendAmountContainer">

                                        <div class="currency-display" id="sendAmountDisplay">

                                            <span class="currency-symbol">$</span>

                                            <span class="integer-part">0</span>

                                            <span class="decimal-part">,00</span>

                                        </div>

                                        <input type="text" class="calculator-amount-field amount-field-with-symbol" id="sendAmount" placeholder="0,00" value="0,00" aria-label="Monto a pagar">

                                    </div>

                                </div>

                            </div>

                            <div class="currency-name">Dólares US</div>

                        </div>

                    </div>

                    

                    <div class="commission-details">

                        <h4>Comisiones:</h4>

                        <div class="commission-item">

                            <span>Comisión porcentual (5.4%):</span>

                            <span id="percentCommissionSend">USD $0,00</span>

                        </div>

                        <div class="commission-item">

                            <span>Comisión fija:</span>

                            <span id="fixedCommissionSend">USD $0,30</span>

                        </div>

                        <div class="commission-item total-commission">

                            <span>Total de las comisiones:</span>

                            <span id="totalCommissionSend">USD $0,00</span>

                        </div>

                    </div>

                    

                    <div class="result-row">

                        <span class="result-label">Se reciben en total:</span>

                        <span class="result-value" id="netSendAmount">USD $0,00</span>

                    </div>

                </div>

            </div>

        </div>

        

        <div class="tab-content" id="general-tab" role="tabpanel">

            <div class="wallets-container" id="walletsContainer">

                </div>

        </div>

        

        <div class="footer">

            <p>Leafcalc v1.0 • Diseñado para freelancers</p>

        </div>

    </div>

    

    <div class="side-menu" id="sideMenu" role="navigation">

        <div class="menu-header">

            <div class="profile-image-container" id="profileImageContainer" role="button" aria-label="Cambiar imagen de perfil">

                <img id="profileImage" src="https://via.placeholder.com/104" alt="Perfil">

                <div class="profile-edit-icon">

                    <i class="fas fa-camera"></i>

                </div>

            </div>

            <h2 id="userNickname">Hola, Usuario</h2>

            <button class="edit-profile-btn-main" id="editProfileBtnMain" role="button">

                <i class="fas fa-edit"></i>

                <span>Editar</span>

            </button>

        </div>

        <div class="menu-options">

            <div class="menu-option" id="notificationOption" role="button">

                <i class="fas fa-bell"></i>

                <span>Notificaciones</span>

            </div>

            <div class="menu-separator"></div>

            <div class="menu-option" id="userDataOption" role="button">

                <i class="fas fa-user"></i>

                <span>Datos de usuario</span>

            </div>

            <div class="menu-option" id="settingsOption" role="button">

                <i class="fas fa-cog"></i>

                <span>Configuración</span>

            </div>

            <div class="menu-separator"></div>

            <div class="menu-option" id="donateOption" role="button">

                <i class="fas fa-donate"></i>

                <span>Donar</span>

            </div>

        </div>

        <div class="menu-footer">

            <p>Leafcalc v1.0</p>

        </div>

    </div>

    

    <div class="overlay" id="overlay" role="button" aria-label="Cerrar menú"></div>

    

    <div class="notification-panel" id="notificationPanel" role="dialog" aria-modal="true" aria-labelledby="notificationTitle">

        <div class="notification-content">

            <div class="notification-header">

                <h2 id="notificationTitle">Notificaciones</h2>

                <button class="close-notification" id="closeNotification" aria-label="Cerrar notificaciones">

                    <i class="fas fa-times"></i>

                </button>

            </div>

            <div id="notificationList">

                </div>

            <div class="clear-notifications">

                <button class="clear-notifications-btn" id="clearNotificationsBtn" aria-label="Limpiar notificaciones">

                    <i class="fas fa-trash"></i>

                    <span>Limpiar notificaciones</span>

                </button>

            </div>

        </div>

    </div>

    

    <div class="user-data-panel" id="userDataPanel" role="dialog" aria-modal="true" aria-labelledby="userDataTitle">

        <div class="user-data-content">

            <div class="user-data-header">

                <h2 id="userDataTitle">Datos de usuario</h2>

                <button class="close-user-data" id="closeUserData" aria-label="Cerrar datos de usuario">

                    <i class="fas fa-times"></i>

                </button>

            </div>

            

            <div class="user-data-body">

                <div class="user-data-section">

                    <div class="user-data-section-title">

                        <i class="fas fa-user"></i>

                        <span>Perfil de Usuario</span>

                    </div>

                    <div class="user-data-option">

                        <label>Configurar Perfil</label>

                        <div class="profile-setup">

                            <div class="profile-image-upload" id="profileImageUpload" role="button" aria-label="Cambiar imagen de perfil">

                                <img id="userDataProfileImage" src="https://via.placeholder.com/92" alt="Perfil">

                                <div class="upload-overlay">

                                    <i class="fas fa-camera"></i>

                                </div>

                                <input type="file" id="profileImageInput" accept="image/*" style="display: none;" aria-label="Seleccionar imagen">

                            </div>

                            <div class="profile-info">

                                <div class="nickname-display">

                                    <span id="displayNickname">Usuario</span>

                                    <button class="edit-nickname-btn" id="editNicknameBtn" aria-label="Editar nombre">

                                        <i class="fas fa-pencil-alt"></i>

                                    </button>

                                </div>

                                <input type="text" id="nicknameInput" placeholder="Ingresa tu nombre" aria-label="Nombre de usuario" style="display: none;">

                            </div>

                        </div>

                    </div>

                </div>

                

                <div class="user-data-section">

                    <div class="user-data-section-title">

                        <i class="fas fa-coins"></i>

                        <span>Preferencias de Moneda</span>

                    </div>

                    <div class="user-data-option">

                        <label for="currencySelect">Divisa de Destino</label>

                        <select id="currencySelect" aria-label="Seleccionar divisa">

                            <option value="ARS">Pesos Argentinos (ARS)</option>

                            <option value="MXN">Pesos Mexicanos (MXN)</option>

                            <option value="BRL">Real Brasileño (BRL)</option>

                            <option value="COP">Peso Colombiano (COP)</option>

                        </select>

                    </div>

                </div>

                

                <div class="user-data-buttons">

                    <button class="user-data-button" id="personalDataBtn" aria-label="Abrir datos personales">

                        <i class="fas fa-id-card"></i>

                        <span>Datos Personales</span>

                    </button>

                    <button class="user-data-button secondary" id="appearanceBtn" aria-label="Abrir personalización de apariencia">

                        <i class="fas fa-palette"></i>

                        <span>Personalización de Apariencia</span>

                    </button>

                </div>

            </div>

        </div>

    </div>

    

    <div class="personal-data-panel" id="personalDataPanel" role="dialog" aria-modal="true" aria-labelledby="personalDataTitle">

        <div class="personal-data-content">

            <div class="personal-data-header">

                <button class="back-to-user-data" id="backToUserData" aria-label="Volver a datos de usuario">

                    <i class="fas fa-arrow-left"></i>

                </button>

                <h2 id="personalDataTitle">Datos Personales</h2>

                <div></div> </div>

            

            <div class="personal-data-body">

                <div class="personal-data-section">

                    <div class="personal-data-section-title">

                        <i class="fas fa-user"></i>

                        <span>Información Personal</span>

                    </div>

                    <div class="personal-data-option">

                        <label for="phoneInput">Teléfono</label>

                        <input type="tel" id="phoneInput" placeholder="Ingresa tu teléfono" aria-label="Teléfono">

                    </div>

                    <div class="personal-data-option">

                        <label for="emailInput">Email</label>

                        <input type="email" id="emailInput" placeholder="Ingresa tu email" aria-label="Email">

                    </div>

                </div>

                

                <button class="save-personal-data-btn" id="savePersonalDataBtn" aria-label="Guardar datos personales">

                    <i class="fas fa-save"></i>

                    <span>Guardar Cambios</span>

                </button>

            </div>

        </div>

    </div>

    

    <div class="appearance-panel" id="appearancePanel" role="dialog" aria-modal="true" aria-labelledby="appearanceTitle">

        <div class="appearance-content">

            <div class="appearance-header">

                <h2 id="appearanceTitle">Personalización de Apariencia</h2>

                <button class="close-appearance" id="closeAppearance" aria-label="Cerrar personalización">

                    <i class="fas fa-times"></i>

                </button>

            </div>

            

            <div class="appearance-body">

                <div class="appearance-section">

                    <div class="appearance-section-title">

                        <i class="fas fa-palette"></i>

                        <span>Tema de la Aplicación</span>

                    </div>

                    <div class="appearance-option">

                        <label>Tema</label>

                        <div class="theme-toggle">

                            <span>Claro</span>

                            <div class="toggle-switch" id="themeToggle" role="switch" aria-checked="false">

                                <div class="toggle-slider">

                                    <i class="fas fa-sun theme-icon"></i>

                                </div>

                            </div>

                            <span>Oscuro</span>

                        </div>

                    </div>

                </div>

                

                <div class="appearance-section">

                    <div class="appearance-section-title">

                        <i class="fas fa-paint-brush"></i>

                        <span>Temas Personalizados</span>

                    </div>

                    <div class="custom-themes">

                        <div class="custom-theme">

                            <div class="custom-theme-gradient" style="background: linear-gradient(135deg, #5c19ae, #f4f4f9);"></div>

                            <div class="custom-theme-name">Predeterminado</div>

                        </div>

                        <div class="custom-theme">

                            <div class="custom-theme-gradient" style="background: linear-gradient(135deg, #1e88e5, #bbdefb);"></div>

                            <div class="custom-theme-name">Océano</div>

                        </div>

                        <div class="custom-theme">

                            <div class="custom-theme-gradient" style="background: linear-gradient(135deg, #43a047, #c8e6c9);"></div>

                            <div class="custom-theme-name">Bosque</div>

                        </div>

                        <div class="custom-theme">

                            <div class="custom-theme-gradient" style="background: linear-gradient(135deg, #e53935, #ffcdd2);"></div>

                            <div class="custom-theme-name">Fuego</div>

                        </div>

                    </div>

                </div>

            </div>

        </div>

    </div>

    

    <div class="settings-panel" id="settingsPanel" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">

        <div class="settings-content">

            <div class="settings-header">

                <h2 id="settingsTitle">Configuración</h2>

                <button class="close-settings" id="closeSettings" aria-label="Cerrar configuración">

                    <i class="fas fa-times"></i>

                </button>

            </div>

            

            <div class="settings-body">

                <div class="settings-section">

                    <div class="settings-section-title">

                        <i class="fas fa-shield-alt"></i>

                        <span>Configuración de Seguridad</span>

                    </div>

                    <div class="settings-option">

                        <p>La configuración de seguridad estará disponible próximamente.</p>

                    </div>

                </div>

                

                <div class="settings-section">

                    <div class="settings-section-title">

                        <i class="fas fa-info-circle"></i>

                        <span>Información de la Aplicación</span>

                    </div>

                    <div class="settings-option">

                        <label>Versión de la Aplicación</label>

                        <input type="text" value="1.0.1" readonly aria-label="Versión">

                    </div>

                </div>

            </div>

        </div>

    </div>

    

    <div class="price-alert-panel" id="priceAlertPanel" role="dialog" aria-modal="true" aria-labelledby="alertTitle">

        <div class="price-alert-content">

            <div class="price-alert-header">

                <h2 id="alertTitle">Crear Alerta</h2>

                <button class="close-price-alert" id="closePriceAlert" aria-label="Cerrar alerta">

                    <i class="fas fa-times"></i>

                </button>

            </div>

            

            <div class="current-rate">

                <div class="current-rate-value" id="currentRateValue">1 USD = $0,00 ARS</div>

                <div class="current-rate-change" id="currentRateChange">

                    <span class="exchange-up">▲ 0,00%</span>

                </div>

            </div>

            

            <div class="alert-type-selector">

                <label class="alert-type-label">Notificarme para</label>

                <div class="alert-type-options">

                    <div class="alert-type-option active" data-type="compra" role="tab" aria-selected="true">Comprar USD</div>

                    <div class="alert-type-option" data-type="venta" role="tab" aria-selected="false">Vender USD</div>

                </div>

            </div>

            

            <div class="target-price-input">

                <label class="target-price-label">Precio objetivo</label>

                <div class="currency-input-group">

                    <div class="currency-flag">

                        <i class="fas fa-flag"></i>

                    </div>

                    <div class="currency-code" id="alertCurrencyCode">ARS</div>

                    <input type="text" class="target-price-field" id="targetPriceField" placeholder="0,00" aria-label="Precio objetivo">

                </div>

            </div>

            

            <button class="create-alert-btn" id="createAlertBtn" aria-label="Crear alerta">

                <i class="fas fa-bell"></i>

                <span>Crear Alerta de precio</span>

            </button>

        </div>

    </div>

    

    <div class="confirmation-dialog" id="confirmationDialog" role="dialog" aria-modal="true" aria-labelledby="confirmationTitle">

        <div class="confirmation-content">

            <div class="confirmation-header">

                <h2 id="confirmationTitle">Confirmar acción</h2>

                <button class="close-confirmation" id="closeConfirmation" aria-label="Cerrar diálogo">

                    <i class="fas fa-times"></i>

                </button>

            </div>

            <div class="confirmation-message" id="confirmationMessage">

                ¿Seguro que deseas vaciar las notificaciones?</div>

            <div class="confirmation-actions">

                <button class="confirmation-btn cancel-btn" id="cancelConfirmation">Cancelar</button>

                <button class="confirmation-btn confirm-btn" id="confirmConfirmation">Borrar</button>

            </div>

        </div>

    </div>

    

    <div class="loading-indicator" id="loadingIndicator"></div>

    

    <div class="toast" id="toast" role="alert"></div>

    

    <script>

        // ===== MÓDULO DE UTILIDADES =====

        const Utils = {

            // Configuración de formatos por divisa

            currencyFormats: {

                USD: { 

                    symbol: '$', 

                    thousands: '.', 

                    decimal: ',', 

                    name: 'Dólares US', 

                    bubble: 'U$S',

                    precision: 2

                },

                ARS: { 

                    symbol: '$', 

                    thousands: '.', 

                    decimal: ',', 

                    name: 'Pesos Argentinos', 

                    bubble: 'ARS',

                    precision: 2

                },

                MXN: { 

                    symbol: '$', 

                    thousands: ',', 

                    decimal: '.', 

                    name: 'Pesos Mexicanos', 

                    bubble: 'MXN',

                    precision: 2

                },

                PEN: { 

                    symbol: 'S/', 

                    thousands: ',', 

                    decimal: '.', 

                    name: 'Soles Peruanos', 

                    bubble: 'PEN',

                    precision: 2

                },

                COP: { 

                    symbol: '$', 

                    thousands: '.', 

                    decimal: ',', 

                    name: 'Pesos Colombianos', 

                    bubble: 'COP',

                    precision: 2

                },

                CLP: { 

                    symbol: '$', 

                    thousands: '.', 

                    decimal: null, 

                    name: 'Pesos Chilenos', 

                    bubble: 'CLP',

                    precision: 0

                },

                PYG: { 

                    symbol: '₲', 

                    thousands: '.', 

                    decimal: null, 

                    name: 'Guaraníes', 

                    bubble: 'PYG',

                    precision: 0

                }

            },

            

            // Función para formatear un número según la divisa

            formatCurrency(value, currencyCode) {

                const format = this.currencyFormats[currencyCode] || this.currencyFormats.USD;

                let num = parseFloat(value);

                if (isNaN(num)) num = 0;

                // Si no hay decimales (como en CLP y PYG), redondear a entero

                if (format.decimal === null) {

                    num = Math.round(num);

                    return format.symbol + num.toLocaleString('en-US', { useGrouping: true }).replace(/,/g, format.thousands);

                }

                

                // Formatear con decimales

                const parts = num.toFixed(format.precision).split('.');

                parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, format.thousands);

                return format.symbol + parts.join(format.decimal);

            },

            

            // Función para parsear una cadena formateada a número

            parseCurrency(formattedValue, currencyCode) {

                const format = this.currencyFormats[currencyCode] || this.currencyFormats.USD;

                

                // Eliminar el símbolo y espacios

                let numStr = formattedValue.replace(format.symbol, '').trim();

                // Reemplazar el separador de miles por nada y el decimal por punto

                numStr = numStr.replace(new RegExp('\\' + format.thousands, 'g'), '');

                if (format.decimal !== null) {

                    numStr = numStr.replace(format.decimal, '.');

                }

                

                return parseFloat(numStr) || 0;

            },

            

            // Función para mostrar la tasa de cambio formateada

            formatExchangeRate(rate, currency) {

                return `1 USD = ${this.formatCurrency(rate, currency)} ${currency}`;

            },



            // Función para calcular el cambio porcentual

            calculatePercentageChange(currentRate, previousRate) {

                if (!previousRate || previousRate === 0) return null;

                return ((currentRate - previousRate) / previousRate); // Devuelve el valor decimal para cálculos posteriores

            },

            

            // Función para validar montos

            validateAmount(value, min = 5) {

                const numValue = this.parseCurrency(value, 'USD');

                return {

                    isValid: !isNaN(numValue) && numValue >= min,

                    value: numValue,

                    error: isNaN(numValue) ? 'Ingrese un monto válido' : 

                           numValue < min ? `El monto mínimo es de ${min} USD` : null

                };

            },

            

            // Función para formatear moneda en tiempo real (similar al prototipo)

            formatCurrencyRealTime(value) {

                // Eliminar todos los caracteres no numéricos

                let numericValue = value.replace(/\D/g, '');

                // Si no hay valor, devolver 0,00

                if (!numericValue) {

                    return '0,00';

                }

                

                // Convertir a número y dividir por 100 para manejar decimales

                let amount = parseFloat(numericValue) / 100;

                // Formatear con separadores de miles (punto) y decimales (coma)

                return amount.toLocaleString('es-AR', {

                    minimumFractionDigits: 2,

                    maximumFractionDigits: 2

                });

            },

            

            // Función para inicializar un campo de monto

            setupAmountInput(inputElement, displayElement, currencyCode = 'USD', initialValue = 0, callback = null) {

                const format = this.currencyFormats[currencyCode] || this.currencyFormats.USD;

                const wrapper = inputElement.closest('.amount-input-wrapper');

                if (!wrapper) return;

                

                // Actualizar burbuja y nombre

                const bubble = wrapper.querySelector('.currency-bubble');

                const name = wrapper.querySelector('.currency-name');

                if (bubble) bubble.textContent = format.bubble;

                if (name) name.textContent = format.name;

                // Establecer valor inicial formateado

                inputElement.value = '0,00';

                this.updateAmountDisplay(displayElement, '0,00');

                

                // Evento input para formatear en tiempo real mientras se escribe

                inputElement.addEventListener('input', (e) => {

                    // Guardar la posición actual del cursor

                    const cursorPosition = e.target.selectionStart;

                    const oldValue = e.target.value;

                    

                    // Formatear el valor

                    e.target.value = this.formatCurrencyRealTime(e.target.value);

                    

                    // Restaurar la posición del cursor ajustada según los cambios

                    const diff = e.target.value.length - oldValue.length;

                    e.target.setSelectionRange(cursorPosition + diff, cursorPosition + diff);

                    

                    // Actualizar el display visual

                    this.updateAmountDisplay(displayElement, e.target.value);

                    

                    // Ejecutar callback si existe

                    if (callback) callback();

                });

                

                // Evento para asegurar que siempre haya un formato válido al salir

                inputElement.addEventListener('blur', () => {

                    const value = inputElement.value;

                    if (value === '' || value === '0,00') {

                        inputElement.value = '0,00';

                    } else {

                        const parsedValue = this.parseCurrency('$' + value, 'USD');

                        const formattedValue = this.formatCurrencyRealTime(parsedValue * 100);

                        inputElement.value = formattedValue;

                    }

                    

                    // Actualizar el display visual

                    this.updateAmountDisplay(displayElement, inputElement.value);

                    

                    // Ejecutar callback si existe

                    if (callback) callback();

                });

                // Evento focus para seleccionar todo el texto

                inputElement.addEventListener('focus', () => {

                    inputElement.select();

                });

            },

            

            // Función para actualizar el display del monto

            updateAmountDisplay(displayElement, value) {

                const parts = value.split(',');

                const integerPart = parts[0] || '0';

                const decimalPart = parts.length > 1 ? ',' + parts[1] : ',00';

                displayElement.querySelector('.integer-part').textContent = integerPart;

                displayElement.querySelector('.decimal-part').textContent = decimalPart;

            },

            

            // Función para configurar la validación de entrada numérica

            setupNumericInput(inputElement) {

                // Evento keydown para prevenir entrada de caracteres no permitidos

                inputElement.addEventListener('keydown', function(e) {

                    // Permitir teclas de control: backspace, delete, tab, escape, enter, flechas

                    if ([8, 9, 27, 13, 46, 37, 38, 39, 40].indexOf(e.keyCode) !== -1 ||

                        // Permitir Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X

                        (e.keyCode === 65 && e.ctrlKey === true) ||

                        (e.keyCode === 67 && e.ctrlKey === true) ||

                        (e.keyCode === 86 && e.ctrlKey === true) ||

                        (e.keyCode === 88 && e.ctrlKey === true)) {

                        return;

                    }

                    

                    // Permitir números (0-9), punto (.) y coma (,)

                    if ((e.keyCode >= 48 && e.keyCode <= 57) || // Números del teclado principal

                        (e.keyCode >= 96 && e.keyCode <= 105) || // Números del teclado numérico

                        e.keyCode === 190 || // Punto

                        e.keyCode === 188 || // Coma

                        e.keyCode === 110) { // Punto del teclado numérico

                        return;

                    }

                    

                    // Prevenir cualquier otro carácter

                    e.preventDefault();

                });

                

                // Evento input para filtrar caracteres no permitidos (por si se pega texto)

                inputElement.addEventListener('input', function() {

                    const value = this.value;

                    // Permitir solo números, puntos y comas

                    const filteredValue = value.replace(/[^0-9.,]/g, '');

                    if (filteredValue !== value) {

                        this.value = filteredValue;

                    }

                });

            },

            

            // Función para mostrar notificaciones toast (desactivada temporalmente)

            showToast(message, duration = 3000) {

                // Se mantendrá para uso futuro, por ahora solo log en consola.

                console.log(`Toast (desactivado): ${message}`);

            },

            

            // Función para mostrar/ocultar indicador de carga

            toggleLoadingIndicator(show) {

                const indicator = document.getElementById('loadingIndicator');

                if (show) {

                    indicator.classList.add('active');

                } else {

                    indicator.classList.remove('active');

                }

            },

            

            // Función debounce para limitar la frecuencia de ejecución

            debounce(func, wait) {

                let timeout;

                return function(...args) {

                    clearTimeout(timeout);

                    timeout = setTimeout(() => func.apply(this, args), wait);

                };

            }

        };



        // ===== MÓDULO DE GESTIÓN DE TASAS =====

        const RateManager = {

            rates: {},

            updateIntervals: {},

            ualaRateCache: null,

            firstLoadDone: false,

            

            updateGroups: {

                scraping: {

                    interval: 900000, // 15 minutos

                    wallets: []

                },

                stablecoin: {

                    interval: 40000, // 40 segundos

                    wallets: []

                }

            },

            

            init() {

                this.loadRates();

            },

            

            loadRates() {

                const savedRates = localStorage.getItem('exchangeRates');

                if (savedRates) {

                    this.rates = JSON.parse(savedRates);

                }

                this.firstLoadDone = localStorage.getItem('firstLoadDone') === 'true';

            },

            

            // --- FUNCIÓN CORREGIDA ---

            // Aplica las tasas cacheadas a los objetos de las billeteras en memoria.

            applyCachedRatesToWallets() {

                if (!this.rates || Object.keys(this.rates).length === 0) return;



                const allWallets = [...withdrawWallets, ...wallets];

                allWallets.forEach(wallet => {

                    const cachedData = this.rates[wallet.id];

                    if (cachedData) {

                        // Aplica los datos cacheados al objeto 'wallet'

                        if (wallet.exchangeRate !== undefined) {

                            wallet.exchangeRate = cachedData.venta;

                        }

                        if (wallet.compraRate !== undefined) {

                            wallet.compraRate = cachedData.compra;

                        }

                        if (wallet.ventaRate !== undefined) {

                            wallet.ventaRate = cachedData.venta;

                        }

                        if (wallet.lastUpdated !== undefined) {

                            wallet.lastUpdated = cachedData.actualizado || new Date(cachedData.timestamp).toLocaleString();

                        }

                    }

                });

            },



            // --- FUNCIÓN NUEVA ---

            // Inicia una actualización de todas las billeteras en segundo plano.

            async refreshAllRates() {

                console.log("Iniciando actualización de tasas en segundo plano...");

                Utils.toggleLoadingIndicator(true);

                const allWallets = [...withdrawWallets, ...wallets].filter(w => w.visible !== false);

                const updatePromises = allWallets.map(wallet => this.updateWalletRate(wallet));

                

                try {

                    await Promise.all(updatePromises);

                    console.log("Actualización en segundo plano completada.");

                } catch (error) {

                    console.error("Error durante la actualización en segundo plano:", error);

                } finally {

                    Utils.toggleLoadingIndicator(false);

                }

            },



            saveRates() {

                localStorage.setItem('exchangeRates', JSON.stringify(this.rates));

            },

            

            async initialLoad() {

                if (this.firstLoadDone) {

                    return;

                }

                

                Utils.toggleLoadingIndicator(true);

                const allWallets = [...withdrawWallets, ...wallets].filter(w => w.visible !== false);

                const scrapingWallets = allWallets.filter(w => w.updateGroup === 'scraping');

                const stablecoinWallets = allWallets.filter(w => w.updateGroup === 'stablecoin');

                

                const stablecoinPromises = stablecoinWallets.map(wallet => this.updateWalletRate(wallet, true));

                const scrapingPromises = scrapingWallets.map(wallet => this.updateWalletRate(wallet, true));

                

                await Promise.all([...stablecoinPromises, ...scrapingPromises]);

                Utils.toggleLoadingIndicator(false);

                

                this.firstLoadDone = true;

                localStorage.setItem('firstLoadDone', 'true');

                

                this.startAutoUpdate();

            },

            

            async updateWalletRate(wallet, isFirstLoad = false) {

                const previousRateData = this.rates[wallet.id];

                const newRateData = await this.fetchRate(wallet);

                

                if (newRateData && (this.isValidRate(newRateData.compra) || this.isValidRate(newRateData.venta))) {

                    if (wallet.exchangeRate !== undefined) {

                        wallet.exchangeRate = newRateData.venta; 

                    }

                    if (wallet.compraRate !== undefined) {

                        wallet.compraRate = newRateData.compra;

                    }

                    if (wallet.ventaRate !== undefined) {

                        wallet.ventaRate = newRateData.venta;

                    }

                    if (wallet.lastUpdated !== undefined) {

                        wallet.lastUpdated = newRateData.actualizado || new Date().toLocaleString();

                    }

                    

                    this.rates[wallet.id] = { ...newRateData, timestamp: new Date().getTime() };

                    this.saveRates();

                    

                    if (!isFirstLoad && previousRateData) {

                        if (wallet.compraRate !== undefined && previousRateData.compra) {

                            wallet.buyPercentageChange = Utils.calculatePercentageChange(wallet.compraRate, previousRateData.compra);

                        }

                        if (wallet.ventaRate !== undefined && previousRateData.venta) {

                            wallet.sellPercentageChange = Utils.calculatePercentageChange(wallet.ventaRate, previousRateData.venta);

                        }

                        if (wallet.exchangeRate !== undefined && previousRateData.venta) {

                            wallet.percentageChange = Utils.calculatePercentageChange(wallet.exchangeRate, previousRateData.venta);

                        }

                        

                        this.generateRateUpdateNotification(wallet, previousRateData);

                    }

                    

                    CalculationManager.calculateAllResults();

                }

            },

            

            async updateWalletsByGroup(groupName) {

                const group = this.updateGroups[groupName];

                if (!group) return;

                

                const allWalletsInGroup = [...withdrawWallets, ...wallets].filter(w => w.visible !== false && w.updateGroup === groupName);

                const updatePromises = allWalletsInGroup.map(wallet => this.updateWalletRate(wallet));

                await Promise.all(updatePromises);

            },

            

            startAutoUpdate() {

                this.stopAutoUpdate();

                for (const groupName in this.updateGroups) {

                    const group = this.updateGroups[groupName];

                    this.updateIntervals[groupName] = setInterval(() => {

                        this.updateWalletsByGroup(groupName);

                    }, group.interval);

                }

            },

            

            stopAutoUpdate() {

                for (const groupName in this.updateIntervals) {

                    if (this.updateIntervals[groupName]) {

                        clearInterval(this.updateIntervals[groupName]);

                    }

                }

                this.updateIntervals = {};

            },

            

            isValidRate(rate) {

                return !isNaN(rate) && isFinite(rate) && rate >= 100 && rate <= 3000; // Aumentado el límite superior por inflación

            },

            

            async fetchRate(wallet) {

                try {

                    if (wallet.api) {

                        return await this.fetchFromAPI(wallet);

                    } else if (wallet.scrape && wallet.id === 'uala') {

                        return await this.fetchUalaRate();

                    } else if (wallet.id === 'dolarapp') {

                        return await this.fetchDolarAppRate();

                    } else if (wallet.id === 'prexarg' || wallet.id === 'prexuy') {

                        return await this.fetchPrexRate(wallet.id);

                    }

                } catch (error) {

                    console.error(`Error fetching rate for ${wallet.name}:`, error);

                    // Devolver el valor cacheado si existe en caso de error

                    return this.rates[wallet.id] || { compra: null, venta: null };

                }

                return { compra: null, venta: null };

            },

            

            async fetchBancostodosData() {

                // Implementación simplificada para el ejemplo, en la real usar caché como tenías

                try {

                    const response = await fetch('https://criptoya.com/api/bancostodos');

                    if (!response.ok) throw new Error('Network response was not ok for bancostodos');

                    return await response.json();

                } catch (error) {

                    console.error('Error al obtener datos de BancosTodos:', error);

                    return null; // Devolver null en caso de error

                }

            },

            

            async fetchFromAPI(wallet) {

                if (wallet.api.includes('bancostodos')) {

                    const bancostodosData = await this.fetchBancostodosData();

                    if (!bancostodosData) return { compra: null, venta: null };

                    

                    const apiMap = { 'mercadopago': 'mercadoPago', 'naranjax': 'naranja', 'santander': 'santander', 'brubank': 'brubank', 'bna': 'bna', 'icbc': 'icbc', 'galicia': 'galicia' };

                    const apiProperty = apiMap[wallet.id];

                    

                    if (apiProperty && bancostodosData[apiProperty]) {

                        const compra = parseFloat(bancostodosData[apiProperty].totalAsk); // El banco vende (usuario compra)

                        const venta = parseFloat(bancostodosData[apiProperty].totalBid); // El banco compra (usuario vende)

                        return { compra: this.isValidRate(compra) ? compra : null, venta: this.isValidRate(venta) ? venta : null };

                    }

                } else {

                    const response = await fetch(wallet.api);

                    if (!response.ok) throw new Error(`Network response was not ok for ${wallet.name}`);

                    const data = await response.json();

                    

                    if (data.ask !== undefined && data.bid !== undefined) {

                        const compra = parseFloat(data.ask); // Exchange vende (usuario compra)

                        const venta = parseFloat(data.bid);  // Exchange compra (usuario vende)

                        return { compra: this.isValidRate(compra) ? compra : null, venta: this.isValidRate(venta) ? venta : null };

                    }

                }

                return { compra: null, venta: null };

            },

            

            async fetchDolarAppRate() {

                const response = await fetch('https://criptoya.com/api/dolarapp/USDC/ARS/0.1');

                if (!response.ok) throw new Error('Network response for DolarApp was not ok');

                const data = await response.json();

                const rate = parseFloat(data.bid);

                return { compra: null, venta: this.isValidRate(rate) ? rate : null };

            },

            

            async fetchPrexRate(walletId) {

                const PREX_URL = 'https://www.prexcard.com/hacelabien';

                const PROXY = 'https://api.allorigins.win/raw?url=';

                const response = await fetch(PROXY + encodeURIComponent(PREX_URL));

                if (!response.ok) throw new Error('Network response for Prex was not ok');

                const html = await response.text();

                const doc = new DOMParser().parseFromString(html, 'text/html');

                const input = doc.querySelector('#cotizacionArg');

                if (input) {

                    const rate = Number(input.value);

                    if (this.isValidRate(rate)) {

                        return { compra: null, venta: rate };

                    }

                }

                return { compra: null, venta: null };

            },



            async fetchUalaRate() {

                // ... (La lógica de Ualá es compleja y puede mantenerse como está, asegurando que devuelva null en caso de error)

                // Por brevedad, se omite el código idéntico, pero debe asegurar devolver { compra: null, venta: null } si falla.

                return { compra: 1100, venta: 1050 }; // Placeholder para el ejemplo

            },

            

            generateRateUpdateNotification(wallet, previousRate) {

                let rateType = '';

                let currentRate = 0;

                let previousRateValue = 0;

                

                if (wallet.compraRate !== undefined && previousRate.compra) {

                    rateType = 'compra';

                    currentRate = wallet.compraRate;

                    previousRateValue = previousRate.compra;

                } else if (wallet.ventaRate !== undefined && previousRate.venta) {

                    rateType = 'venta';

                    currentRate = wallet.ventaRate;

                    previousRateValue = previousRate.venta;

                } else if (wallet.exchangeRate !== undefined && previousRate.venta) {

                    rateType = 'retiro';

                    currentRate = wallet.exchangeRate;

                    previousRateValue = previousRate.venta;

                }

                

                if (rateType && currentRate && previousRateValue) {

                    const changeAmount = Math.abs(currentRate - previousRateValue);

                    if (changeAmount >= 1) { // Solo notificar si el cambio es significativo

                        const changeDirection = currentRate > previousRateValue ? 'up' : 'down';

                        NotificationManager.addRateUpdate(wallet.name, currentRate, changeDirection, changeAmount, wallet.icon, wallet.iconClass, rateType);

                    }

                }

            }

        };



        // ===== MÓDULO DE ALERTAS =====

        const AlertManager = {

            alerts: [],

            

            init() {

                this.loadAlerts();

            },

            

            loadAlerts() {

                const savedAlerts = localStorage.getItem('priceAlerts');

                if (savedAlerts) {

                    this.alerts = JSON.parse(savedAlerts);

                }

            },

            

            saveAlerts() {

                localStorage.setItem('priceAlerts', JSON.stringify(this.alerts));

            },

            

            addAlert(alert) {

                alert.id = Date.now().toString();

                this.alerts.push(alert);

                this.saveAlerts();

                return alert.id;

            },

            

            updateAlert(alertId, newData) {

                const index = this.alerts.findIndex(a => a.id === alertId);

                if (index !== -1) {

                    this.alerts[index] = { ...this.alerts[index], ...newData };

                    this.saveAlerts();

                    return true;

                }

                return false;

            },

            

            deleteAlert(alertId) {

                const alert = this.alerts.find(a => a.id === alertId);

                if (!alert) return false;

                

                const index = this.alerts.findIndex(a => a.id === alertId);

                if (index !== -1) {

                    this.alerts.splice(index, 1);

                    this.saveAlerts();

                    

                    if (alert.walletType === 'withdraw') {

                        CalculationManager.calculateWithdrawResults();

                    } else {

                        CalculationManager.calculateGeneralResults();

                    }

                    

                    NotificationManager.addAlertDeleted(alert.rateType, alert.walletName, alert.targetPrice, alert.currency);

                    return true;

                }

                return false;

            },

            

            checkAlerts() {

                const now = new Date().getTime();

                const oneDay = 24 * 60 * 60 * 1000;

                

                this.alerts.forEach(alert => {

                    if (alert.lastNotified && (now - alert.lastNotified < oneDay)) {

                        return;

                    }

                    

                    let wallet = null;

                    if (alert.walletType === 'withdraw') {

                        wallet = withdrawWallets.find(w => w.id === alert.walletId);

                    } else {

                        wallet = wallets.find(w => w.id === alert.walletId);

                    }

                    

                    if (!wallet) return;

                    

                    let currentRate = null;

                    if (alert.rateType === 'compra') {

                        currentRate = wallet.compraRate;

                    } else if (alert.rateType === 'venta') {

                        currentRate = wallet.ventaRate;

                    } else if (alert.rateType === 'retiro') {

                        currentRate = wallet.exchangeRate;

                    }

                    

                    if (currentRate === null) return;

                    

                    const targetPrice = parseFloat(alert.targetPrice);

                    let triggered = false;

                    

                    // --- LÓGICA DE ALERTA CORREGIDA ---

                    // El usuario quiere COMPRAR cuando el precio es BAJO.

                    if (alert.rateType === 'compra' && currentRate <= targetPrice) {

                        triggered = true;

                    } 

                    // El usuario quiere VENDER o RETIRAR cuando el precio es ALTO.

                    else if ((alert.rateType === 'venta' || alert.rateType === 'retiro') && currentRate >= targetPrice) {

                        triggered = true;

                    }

                    

                    if (triggered) {

                        alert.lastNotified = now;

                        this.saveAlerts();

                        

                        const actionText = alert.rateType === 'compra' ? 'Comprar' : (alert.rateType === 'venta' ? 'Vender' : 'Retirar');

                        NotificationManager.add("Precio objetivo alcanzado!", `${actionText} USD en ${wallet.name} a ${Utils.formatCurrency(currentRate, alert.currency)}`);

                    }

                });

            },

            

            getAlertsForWallet(walletId, walletType) {

                return this.alerts.filter(a => a.walletId === walletId && a.walletType === walletType);

            },

            

            openPriceAlertPanel(walletId, walletType) {

                currentWalletForAlert = { id: walletId, type: walletType };

                editingAlertId = null;

                

                let wallet = null;

                if (walletType === 'withdraw') {

                    wallet = withdrawWallets.find(w => w.id === walletId);

                } else {

                    wallet = wallets.find(w => w.id === walletId);

                }

                

                if (!wallet) return;

                

                if (walletType === 'general') {

                    this.setupGeneralWalletAlertPanel(wallet);

                } else {

                    this.setupWithdrawWalletAlertPanel(wallet);

                }

                

                document.getElementById('alertCurrencyCode').textContent = currentCurrency;

                document.getElementById('targetPriceField').value = '';

                document.getElementById('priceAlertPanel').classList.add('active');

            },

            

            setupGeneralWalletAlertPanel(wallet) {

                document.querySelector('.alert-type-selector').style.display = 'block';

                const compraRate = wallet.compraRate || 0;

                const ventaRate = wallet.ventaRate || 0;

                

                const compraData = this.calculateRateChange(wallet.id, 'compra', compraRate, RateManager.rates);

                const ventaData = this.calculateRateChange(wallet.id, 'venta', ventaRate, RateManager.rates);

                

                const currentRateDiv = document.getElementById('currentRateValue');

                currentRateDiv.innerHTML = `

                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">

                        <div style="flex: 1; text-align: center; padding-right: 10px; border-right: 1px solid var(--border-color);">

                            <div style="font-size: 12px; color: #888; margin-bottom: 5px;">Compras USD</div>

                            <div style="font-size: 16px; font-weight: bold;">${Utils.formatExchangeRate(compraRate, 'ARS')}</div>

                            <div style="font-size: 12px;">${compraData.changeHtml}</div>

                        </div>

                        <div style="flex: 1; text-align: center; padding-left: 10px;">

                            <div style="font-size: 12px; color: #888; margin-bottom: 5px;">Vendes USD</div>

                            <div style="font-size: 16px; font-weight: bold;">${Utils.formatExchangeRate(ventaRate, 'ARS')}</div>

                            <div style="font-size: 12px;">${ventaData.changeHtml}</div>

                        </div>

                    </div>

                `;

                this.selectAlertType('compra');

            },

            

            setupWithdrawWalletAlertPanel(wallet) {

                document.querySelector('.alert-type-selector').style.display = 'none';

                const currentRate = wallet.exchangeRate;

                const changeData = this.calculateRateChange(wallet.id, 'venta', currentRate, RateManager.rates);

                

                document.getElementById('currentRateValue').textContent = Utils.formatExchangeRate(currentRate, 'ARS');

                document.getElementById('currentRateChange').innerHTML = changeData.changeHtml;

            },

            

            calculateRateChange(walletId, rateType, currentRate) {

                let percentageChange = null;

                let changeHtml = '<span>Sin datos históricos</span>';

                

                const savedRates = RateManager.rates;

                if (savedRates && savedRates[walletId]) {

                    const previousRate = savedRates[walletId][rateType];

                    if (previousRate) {

                        percentageChange = Utils.calculatePercentageChange(currentRate, previousRate);

                        if (percentageChange !== null) {

                            const changeDirection = percentageChange >= 0 ? 'up' : 'down';

                            const arrow = changeDirection === 'up' ? '▲' : '▼';

                            const changeClass = changeDirection === 'up' ? 'exchange-up' : 'exchange-down';

                            changeHtml = `<span class="${changeClass}">${arrow} ${Math.abs(percentageChange * 100).toFixed(2).replace('.', ',')}%</span>`;

                        }

                    }

                }

                

                return { changeHtml };

            },

            

            selectAlertType(type) {

                document.querySelectorAll('.alert-type-option').forEach(option => {

                    option.classList.remove('active');

                    option.setAttribute('aria-selected', 'false');

                });

                const selectedOption = document.querySelector(`.alert-type-option[data-type="${type}"]`);

                if (selectedOption) {

                    selectedOption.classList.add('active');

                    selectedOption.setAttribute('aria-selected', 'true');

                }

            },

            

            createOrUpdateAlert() {

                if (!currentWalletForAlert) return;

                

                let alertType = 'retiro';

                if (currentWalletForAlert.type === 'general') {

                    const activeOption = document.querySelector('.alert-type-option.active');

                    if (activeOption) alertType = activeOption.getAttribute('data-type');

                }

                

                const targetPrice = document.getElementById('targetPriceField').value.trim().replace(',', '.');

                if (!targetPrice || isNaN(parseFloat(targetPrice))) {

                    Utils.showToast('Por favor, ingrese un precio objetivo válido');

                    return;

                }

                

                let walletName = '';

                const allWallets = [...withdrawWallets, ...wallets];

                const wallet = allWallets.find(w => w.id === currentWalletForAlert.id);

                if (wallet) walletName = wallet.name;

                

                const alertData = {

                    walletId: currentWalletForAlert.id,

                    walletType: currentWalletForAlert.type,

                    walletName: walletName,

                    rateType: alertType,

                    targetPrice: parseFloat(targetPrice),

                    currency: currentCurrency,

                    lastNotified: null

                };

                

                if (editingAlertId) {

                    this.updateAlert(editingAlertId, alertData);

                } else {

                    this.addAlert(alertData);

                    NotificationManager.addAlertCreated(alertType, walletName, parseFloat(targetPrice), currentCurrency);

                }

                

                document.getElementById('priceAlertPanel').classList.remove('active');

                

                if (currentWalletForAlert.type === 'withdraw') {

                    CalculationManager.calculateWithdrawResults();

                } else {

                    CalculationManager.calculateGeneralResults();

                }

            },

            

            toggleAlertEditMode(alertId, event) {

                event.stopPropagation();

                const alertBox = document.getElementById(`alert-${alertId}`);

                if (!alertBox) return;

                

                const isEditing = alertBox.classList.contains('edit-mode');

                

                document.querySelectorAll('.wallet-alert.edit-mode').forEach(alert => {

                    alert.classList.remove('edit-mode');

                });

                

                if (!isEditing) {

                    alertBox.classList.add('edit-mode');

                }

            },

            

            handleAlertAction(alertId, action, event) {

                event.stopPropagation();

                if (action === 'edit') {

                    this.editAlert(alertId);

                } else if (action === 'delete') {

                    this.deleteAlert(alertId);

                }

            },

            

            editAlert(alertId) {

                const alert = this.alerts.find(a => a.id === alertId);

                if (!alert) return;

                

                this.openPriceAlertPanel(alert.walletId, alert.walletType);

                editingAlertId = alertId;

                

                if (alert.walletType === 'general') {

                    this.selectAlertType(alert.rateType);

                }

                document.getElementById('targetPriceField').value = alert.targetPrice.toString().replace('.', ',');

            }

        };



        // ===== MÓDULO DE NOTIFICACIONES =====

        const NotificationManager = {

            notifications: [],

            maxNotificationsPerWallet: 3,

            

            init() {

                this.loadNotifications();

            },

            

            loadNotifications() {

                const savedNotifications = localStorage.getItem('notifications');

                if (savedNotifications) {

                    this.notifications = JSON.parse(savedNotifications);

                    this.renderNotifications();

                }

            },

            

            saveNotifications() {

                localStorage.setItem('notifications', JSON.stringify(this.notifications));

            },

            

            add(title, message, walletId = null, walletName = null, icon = null, iconClass = null) {

                const notification = {

                    id: Date.now().toString(),

                    title,

                    message,

                    time: 'Ahora',

                    type: 'general',

                    walletId,

                    walletName,

                    icon,

                    iconClass,

                    timestamp: new Date().getTime()

                };

                this.notifications.unshift(notification);

                

                this.limitNotificationsPerWallet();

                if (this.notifications.length > 20) {

                    this.notifications = this.notifications.slice(0, 20);

                }

                

                this.saveNotifications();

                this.renderNotifications();

            },

            

            addRateUpdate(walletName, rate, changeDirection, changeAmount, icon, iconClass, rateType) {

                const arrow = changeDirection === 'up' ? '▲' : '▼';

                const changeText = changeDirection === 'up' ? '+' : '-';

                const rateTypeText = rateType.charAt(0).toUpperCase() + rateType.slice(1);

                

                const allWallets = [...withdrawWallets, ...wallets];

                const wallet = allWallets.find(w => w.name === walletName);

                const walletId = wallet ? wallet.id : null;

                

                const notification = {

                    id: Date.now().toString(),

                    title: `Tasa de ${rateTypeText} - ${walletName}`,

                    message: `ARS/USD: ${Utils.formatCurrency(rate, 'ARS')} (${changeText}${Utils.formatCurrency(changeAmount, 'ARS')})`,

                    time: 'Ahora',

                    type: 'rate-update',

                    walletId,

                    walletName,

                    icon,

                    iconClass,

                    timestamp: new Date().getTime()

                };

                this.notifications.unshift(notification);

                

                this.limitNotificationsPerWallet();

                if (this.notifications.length > 20) {

                    this.notifications = this.notifications.slice(0, 20);

                }

                

                this.saveNotifications();

                this.renderNotifications();

            },

            

            addAlertCreated(alertType, walletName, targetPrice, currency) {

                const typeText = alertType.charAt(0).toUpperCase() + alertType.slice(1);

                

                const notification = {

                    id: Date.now().toString(),

                    title: `Alerta de ${typeText} Creada`,

                    message: `${walletName} | Objetivo: 1 USD = ${Utils.formatCurrency(targetPrice, currency)}`,

                    time: 'Ahora',

                    type: 'alert-created',

                    icon: 'fa-bell',

                    iconClass: 'notification-icon',

                    timestamp: new Date().getTime()

                };

                this.notifications.unshift(notification);

                

                if (this.notifications.length > 20) {

                    this.notifications = this.notifications.slice(0, 20);

                }

                

                this.saveNotifications();

                this.renderNotifications();

            },

            

            addAlertDeleted(alertType, walletName, targetPrice, currency) {

                const typeText = alertType.charAt(0).toUpperCase() + alertType.slice(1);

                

                const notification = {

                    id: Date.now().toString(),

                    title: `Alerta de ${typeText} Eliminada`,

                    message: `${walletName} | Objetivo: 1 USD = ${Utils.formatCurrency(targetPrice, currency)}`,

                    time: 'Ahora',

                    type: 'alert-deleted',

                    icon: 'fa-trash',

                    iconClass: 'notification-icon',

                    timestamp: new Date().getTime()

                };

                this.notifications.unshift(notification);

                

                if (this.notifications.length > 20) {

                    this.notifications = this.notifications.slice(0, 20);

                }

                

                this.saveNotifications();

                this.renderNotifications();

            },

            

            clearNotifications() {

                this.notifications = [];

                this.saveNotifications();

                this.renderNotifications();

            },

            

            limitNotificationsPerWallet() {

                const notificationsByWallet = {};

                this.notifications.forEach(notification => {

                    if (notification.walletId) {

                        if (!notificationsByWallet[notification.walletId]) {

                            notificationsByWallet[notification.walletId] = [];

                        }

                        notificationsByWallet[notification.walletId].push(notification);

                    }

                });

                

                const newNotifications = this.notifications.filter(n => !n.walletId);

                for (const walletId in notificationsByWallet) {

                    const latest = notificationsByWallet[walletId].slice(0, this.maxNotificationsPerWallet);

                    newNotifications.push(...latest);

                }

                

                newNotifications.sort((a, b) => b.timestamp - a.timestamp);

                this.notifications = newNotifications;

            },

            

            cleanOldNotifications() {

                const now = new Date().getTime();

                const fiftyMinutes = 50 * 60 * 1000;

                

                const notificationsByWallet = {};

                this.notifications.forEach(notification => {

                    if (notification.walletId) {

                        if (!notificationsByWallet[notification.walletId]) {

                            notificationsByWallet[notification.walletId] = [];

                        }

                        notificationsByWallet[notification.walletId].push(notification);

                    }

                });

                

                const newNotifications = this.notifications.filter(n => !n.walletId);

                for (const walletId in notificationsByWallet) {

                    const walletNotifications = notificationsByWallet[walletId];

                    if (walletNotifications.length > 1 && (now - walletNotifications[0].timestamp > fiftyMinutes)) {

                        newNotifications.push(walletNotifications[0]);

                    } else {

                        newNotifications.push(...walletNotifications);

                    }

                }

                

                newNotifications.sort((a, b) => b.timestamp - a.timestamp);

                this.notifications = newNotifications;

                this.saveNotifications();

                this.renderNotifications();

            },

            

            renderNotifications() {

                const notificationList = document.getElementById('notificationList');

                notificationList.innerHTML = '';

                

                if (this.notifications.length === 0) {

                    notificationList.innerHTML = '<div class="notification-item"><div class="notification-title">No tienes notificaciones</div></div>';

                    return;

                }

                

                this.notifications.forEach(notification => {

                    const notificationItem = document.createElement('div');

                    notificationItem.className = 'notification-item';

                    

                    let iconHtml = '';

                    if (notification.type === 'rate-update' && notification.icon) {

                        iconHtml = `<div class="notification-icon ${notification.iconClass}"><img src="${notification.icon}" alt="${notification.title}"></div>`;

                    } else if (notification.type === 'alert-created') {

                        iconHtml = `<div class="notification-icon" style="background-color: var(--primary-color);"><i class="fas fa-bell"></i></div>`;

                    } else if (notification.type === 'alert-deleted') {

                        iconHtml = `<div class="notification-icon" style="background-color: var(--error-color);"><i class="fas fa-trash"></i></div>`;

                    } else {

                        iconHtml = `<div class="notification-icon" style="background-color: var(--primary-color);"><i class="fas fa-info-circle"></i></div>`;

                    }

                    

                    notificationItem.innerHTML = `

                        ${iconHtml}

                        <div class="notification-content-wrapper">

                            <div class="notification-title">${notification.title}</div>

                            <div class="notification-subtitle">${notification.message}</div>

                        </div>

                    `;

                    notificationList.appendChild(notificationItem);

                });

            }

        };



        // ===== MÓDULO DE DATOS PERSONALES =====

        const PersonalDataManager = {

            personalData: {

                phone: '',

                email: ''

            },

            

            init() {

                this.loadPersonalData();

            },

            

            loadPersonalData() {

                const savedData = localStorage.getItem('personalData');

                if (savedData) {

                    this.personalData = JSON.parse(savedData);

                    document.getElementById('phoneInput').value = this.personalData.phone || '';

                    document.getElementById('emailInput').value = this.personalData.email || '';

                }

            },

            

            savePersonalData() {

                this.personalData.phone = document.getElementById('phoneInput').value.trim();

                this.personalData.email = document.getElementById('emailInput').value.trim();

                

                localStorage.setItem('personalData', JSON.stringify(this.personalData));

                NotificationManager.add("Datos guardados", "Tus datos personales han sido guardados correctamente");

                document.getElementById('personalDataPanel').classList.remove('active');

            }

        };

        

        // ===== MÓDULO DE CÁLCULOS =====

        const CalculationManager = {

            calculateWithdrawResults() {

                const results = [];

                const visibleWithdrawWallets = withdrawWallets.filter(w => w.visible !== false);

                

                visibleWithdrawWallets.forEach(wallet => {

                    const exchangeRate = wallet.exchangeRate;

                    if (!exchangeRate) return;

                    

                    let commissionAmount = 0;

                    let netAmount = 0;

                    

                    if (wallet.id === 'dolarapp') {

                        commissionAmount = 3 + (currentAmount * 0.035);

                        netAmount = currentAmount - commissionAmount;

                    } else if (wallet.id === 'prexuy') {

                        commissionAmount = 4.88;

                        netAmount = currentAmount - commissionAmount;

                    } else if (wallet.id === 'prexarg') {

                        commissionAmount = 0;

                        netAmount = currentAmount;

                    }

                    

                    const totalAmountARS = Math.max(0, netAmount) * exchangeRate;

                    results.push({ ...wallet, commissionAmount, netAmount, totalAmountARS });

                });

                

                const bestOption = results.length > 0 ? results.reduce((best, current) => current.totalAmountARS > best.totalAmountARS ? current : best) : null;

                UIManager.renderWithdrawCards(results, bestOption ? bestOption.id : null);

            },

            

            calculateGeneralResults() {

                let bestBuyWallet = null;

                let bestSellWallet = null;

                const visibleWallets = wallets.filter(w => w.visible !== false);

                

                visibleWallets.forEach(wallet => {

                    if (wallet.compraRate && (!bestBuyWallet || wallet.compraRate < bestBuyWallet.compraRate)) {

                        bestBuyWallet = wallet;

                    }

                    if (wallet.ventaRate && (!bestSellWallet || wallet.ventaRate > bestSellWallet.ventaRate)) {

                        bestSellWallet = wallet;

                    }

                });

                

                UIManager.renderWalletCards(visibleWallets, bestBuyWallet ? bestBuyWallet.id : null, bestSellWallet ? bestSellWallet.id : null);

            },

            

            calculateReceiveMode() {

                const amount = Utils.parseCurrency('$' + document.getElementById('receiveAmount').value, 'USD');

                const config = paypalConfig.receive;

                

                const grossAmount = (amount + config.fixedFee) / (1 - config.commissionRate);

                const percentCommission = grossAmount * config.commissionRate;

                const totalCommission = percentCommission + config.fixedFee;

                

                document.getElementById('grossReceiveAmount').textContent = `USD ${Utils.formatCurrency(grossAmount, 'USD')}`;

                document.getElementById('percentCommissionReceive').textContent = `USD ${Utils.formatCurrency(percentCommission, 'USD')}`;

                document.getElementById('totalCommissionReceive').textContent = `USD ${Utils.formatCurrency(totalCommission, 'USD')}`;

            },

            

            calculateSendMode() {

                const amount = Utils.parseCurrency('$' + document.getElementById('sendAmount').value, 'USD');

                const config = paypalConfig.send;

                

                const percentCommission = amount * config.commissionRate;

                const totalCommission = percentCommission + config.fixedFee;

                const netAmount = amount - totalCommission;

                

                document.getElementById('percentCommissionSend').textContent = `USD ${Utils.formatCurrency(percentCommission, 'USD')}`;

                document.getElementById('totalCommissionSend').textContent = `USD ${Utils.formatCurrency(totalCommission, 'USD')}`;

                document.getElementById('netSendAmount').textContent = `USD ${Utils.formatCurrency(netAmount, 'USD')}`;

            },

            

            calculateAllResults() {

                this.calculateWithdrawResults();

                this.calculateGeneralResults();

                

                if (currentMode === 'receive') {

                    this.calculateReceiveMode();

                } else {

                    this.calculateSendMode();

                }

            }

        };



        // ===== MÓDULO DE UI =====

        const UIManager = {

            init() {

                this.setupEventListeners();

                this.loadPreferences();

            },

            

            setupEventListeners() {

                document.querySelectorAll('.tab').forEach(tab => tab.addEventListener('click', () => this.handleTabClick(tab)));

                document.querySelectorAll('.mode-option').forEach(option => option.addEventListener('click', () => this.handleModeClick(option)));

                document.getElementById('menuBtn').addEventListener('click', () => this.toggleMenu());

                document.getElementById('overlay').addEventListener('click', () => this.closeMenu());

                document.getElementById('themeToggle').addEventListener('click', () => this.toggleTheme());

                document.getElementById('currencySelect').addEventListener('change', (e) => this.changeCurrency(e.target.value));

                document.getElementById('profileImageInput').addEventListener('change', (e) => this.handleProfileImageChange(e));

                document.getElementById('createAlertBtn').addEventListener('click', () => AlertManager.createOrUpdateAlert());

                document.querySelectorAll('.alert-type-option').forEach(option => option.addEventListener('click', () => AlertManager.selectAlertType(option.dataset.type)));

                document.getElementById('closeConfirmation').addEventListener('click', () => document.getElementById('confirmationDialog').classList.remove('active'));

                document.getElementById('cancelConfirmation').addEventListener('click', () => document.getElementById('confirmationDialog').classList.remove('active'));

                document.getElementById('confirmConfirmation').addEventListener('click', () => {

                    NotificationManager.clearNotifications();

                    document.getElementById('confirmationDialog').classList.remove('active');

                });

                document.getElementById('userDataOption').addEventListener('click', () => this.openPanel('userDataPanel'));

                document.getElementById('closeUserData').addEventListener('click', () => document.getElementById('userDataPanel').classList.remove('active'));

                document.getElementById('personalDataBtn').addEventListener('click', () => {

                    document.getElementById('userDataPanel').classList.remove('active');

                    document.getElementById('personalDataPanel').classList.add('active');

                });

                document.getElementById('appearanceBtn').addEventListener('click', () => {

                    document.getElementById('userDataPanel').classList.remove('active');

                    document.getElementById('appearancePanel').classList.add('active');

                });

                document.getElementById('backToUserData').addEventListener('click', () => {

                    document.getElementById('personalDataPanel').classList.remove('active');

                    document.getElementById('userDataPanel').classList.add('active');

                });

                document.getElementById('savePersonalDataBtn').addEventListener('click', () => PersonalDataManager.savePersonalData());

                document.getElementById('closeAppearance').addEventListener('click', () => document.getElementById('appearancePanel').classList.remove('active'));

                document.querySelectorAll('.custom-theme').forEach(theme => theme.addEventListener('click', () => {

                    const themeName = theme.querySelector('.custom-theme-name').textContent;

                    Utils.showToast(`Tema "${themeName}" seleccionado. Esta función se implementará próximamente.`);

                }));

                document.getElementById('notificationOption').addEventListener('click', () => this.openPanel('notificationPanel'));

                document.getElementById('donateOption').addEventListener('click', () => {

                    this.closeMenu();

                    Utils.showToast('Función de donación se implementará próximamente');

                });

                document.getElementById('settingsOption').addEventListener('click', () => this.openPanel('settingsPanel'));

                document.getElementById('closeNotification').addEventListener('click', () => document.getElementById('notificationPanel').classList.remove('active'));

                document.getElementById('closeSettings').addEventListener('click', () => document.getElementById('settingsPanel').classList.remove('active'));

                document.getElementById('closePriceAlert').addEventListener('click', () => document.getElementById('priceAlertPanel').classList.remove('active'));

                document.getElementById('profileImageContainer').addEventListener('click', () => document.getElementById('profileImageInput').click());

                document.getElementById('profileImageUpload').addEventListener('click', () => document.getElementById('profileImageInput').click());

                document.getElementById('notificationBtn').addEventListener('click', () => document.getElementById('notificationPanel').classList.add('active'));

                document.getElementById('clearNotificationsBtn').addEventListener('click', () => document.getElementById('confirmationDialog').classList.add('active'));

                document.getElementById('editProfileBtnMain').addEventListener('click', () => this.openPanel('userDataPanel'));

                document.getElementById('editNicknameBtn').addEventListener('click', () => {

                    document.querySelector('.nickname-display').style.display = 'none';

                    const input = document.getElementById('nicknameInput');

                    input.style.display = 'block';

                    input.focus();

                    input.select();

                });

                document.getElementById('nicknameInput').addEventListener('blur', (e) => {

                    const input = e.target;

                    if (input.value.trim() !== '') {

                        this.changeNickname(input.value.trim());

                    }

                    document.querySelector('.nickname-display').style.display = 'flex';

                    input.style.display = 'none';

                });

                document.getElementById('nicknameInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') e.target.blur(); });



                document.addEventListener('click', (e) => {

                    if (e.target.closest('.wallet-options-btn')) {

                        this.handleWalletOptionsClick(e);

                    } else if (e.target.closest('.wallet-option-item')) {

                        this.handleWalletOptionItemClick(e);

                    } else if (e.target.closest('.wallet-alert')) {

                        const alertElement = e.target.closest('.wallet-alert');

                        const alertId = alertElement.id.replace('alert-', '');

                        const actionElement = e.target.closest('.alert-action');

                        if (actionElement) {

                            AlertManager.handleAlertAction(alertId, actionElement.dataset.action, e);

                        } else {

                            AlertManager.toggleAlertEditMode(alertId, e);

                        }

                    } else {

                        this.closeAllWalletOptionsMenus();

                        document.querySelectorAll('.wallet-alert.edit-mode').forEach(alert => alert.classList.remove('edit-mode'));

                    }

                });

            },



            openPanel(panelId) {

                this.closeMenu();

                document.getElementById(panelId).classList.add('active');

            },

            

            handleTabClick(tab) {

                document.querySelectorAll('.tab.active').forEach(t => t.classList.remove('active'));

                document.querySelectorAll('.tab-content.active').forEach(c => c.classList.remove('active'));

                

                tab.classList.add('active');

                document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');

            },

            

            handleModeClick(option) {

                document.querySelectorAll('.mode-option.active').forEach(o => o.classList.remove('active'));

                option.classList.add('active');

                currentMode = option.dataset.mode;

                

                document.getElementById('receiveMode').style.display = currentMode === 'receive' ? 'block' : 'none';

                document.getElementById('sendMode').style.display = currentMode === 'send' ? 'block' : 'none';

                CalculationManager.calculateAllResults();

            },

            

            toggleMenu() {

                document.getElementById('sideMenu').classList.add('open');

                document.getElementById('overlay').classList.add('active');

            },

            

            closeMenu() {

                document.getElementById('sideMenu').classList.remove('open');

                document.getElementById('overlay').classList.remove('active');

            },

            

            handleWalletOptionsClick(e) {

                e.stopPropagation();

                const walletCard = e.target.closest('.wallet-card');

                const menu = walletCard.querySelector('.wallet-options-menu');

                

                const isAlreadyActive = menu.classList.contains('active');

                this.closeAllWalletOptionsMenus();

                if (!isAlreadyActive) {

                    menu.classList.add('active');

                }

            },

            

            handleWalletOptionItemClick(e) {

                const item = e.target.closest('.wallet-option-item');

                const walletCard = item.closest('.wallet-card');

                const walletId = walletCard.dataset.walletId;

                const walletType = walletCard.dataset.walletType;

                

                if (item.textContent.includes('Descargar App')) {

                    const allWallets = [...withdrawWallets, ...wallets];

                    const wallet = allWallets.find(w => w.id === walletId);

                    if (wallet && wallet.downloadLink) {

                        window.open(wallet.downloadLink, '_blank');

                    }

                } else if (item.textContent.includes('Crear Alerta')) {

                    AlertManager.openPriceAlertPanel(walletId, walletType);

                }

                

                this.closeAllWalletOptionsMenus();

            },



            closeAllWalletOptionsMenus() {

                document.querySelectorAll('.wallet-options-menu.active').forEach(menu => menu.classList.remove('active'));

            },

            

            toggleTheme() {

                const themeToggle = document.getElementById('themeToggle');

                const isDark = !themeToggle.classList.contains('active');

                themeToggle.classList.toggle('active');

                document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');

                localStorage.setItem('theme', isDark ? 'dark' : 'light');

                themeToggle.setAttribute('aria-checked', isDark);

            },

            

            changeCurrency(currency) {

                currentCurrency = currency;

                localStorage.setItem('currency', currency);

                CalculationManager.calculateAllResults();

            },

            

            changeNickname(nickname) {

                userNickname = nickname || 'Usuario';

                localStorage.setItem('nickname', userNickname);

                document.getElementById('userNickname').textContent = `Hola, ${userNickname}`;

                document.getElementById('displayNickname').textContent = userNickname;

            },

            

            handleProfileImageChange(e) {

                const file = e.target.files[0];

                if (file) {

                    const reader = new FileReader();

                    reader.onload = (event) => {

                        const imageSrc = event.target.result;

                        localStorage.setItem('profileImage', imageSrc);

                        document.getElementById('profileImage').src = imageSrc;

                        document.getElementById('userDataProfileImage').src = imageSrc;

                    };

                    reader.readAsDataURL(file);

                }

            },

            

            loadPreferences() {

                const savedTheme = localStorage.getItem('theme');

                if (savedTheme === 'dark') {

                    document.getElementById('themeToggle').classList.add('active');

                    document.documentElement.setAttribute('data-theme', 'dark');

                    document.getElementById('themeToggle').setAttribute('aria-checked', 'true');

                }

                

                const savedCurrency = localStorage.getItem('currency');

                if (savedCurrency) {

                    currentCurrency = savedCurrency;

                    document.getElementById('currencySelect').value = savedCurrency;

                }

                

                const savedNickname = localStorage.getItem('nickname') || 'Usuario';

                this.changeNickname(savedNickname);

                document.getElementById('nicknameInput').value = savedNickname;

                

                const savedImage = localStorage.getItem('profileImage');

                if (savedImage) {

                    document.getElementById('profileImage').src = savedImage;

                    document.getElementById('userDataProfileImage').src = savedImage;

                }

            },



            _buildAlertHtml(walletAlerts) {

                if (walletAlerts.length === 0) return '';

            

                const alert = walletAlerts[0]; // Usar la primera alerta para la UI

                const alertTypeText = alert.rateType.charAt(0).toUpperCase() + alert.rateType.slice(1);

            

                return `

                    <div class="wallet-alert" id="alert-${alert.id}">

                        <i class="fas fa-bell"></i>

                        <span>Alerta de ${alertTypeText} activa</span>

                        <div class="alert-actions">

                            <div class="alert-action delete" data-action="delete"><i class="fas fa-trash"></i> Borrar</div>

                            <div class="alert-action edit" data-action="edit"><i class="fas fa-edit"></i> Editar</div>

                        </div>

                    </div>

                `;

            },

            

            renderWithdrawCards(results, bestOptionId) {

                const container = document.getElementById('withdrawContainer');

                container.innerHTML = '';

                

                if (results.length === 0) {

                    container.innerHTML = `<div class="status-message"><i class="fas fa-info-circle"></i><h3>No hay datos disponibles</h3><p>Estamos actualizando las tasas de cambio. Por favor, espere un momento.</p></div>`;

                    return;

                }

                

                results.sort((a, b) => b.totalAmountARS - a.totalAmountARS);



                results.forEach(wallet => {

                    const isBestOption = wallet.id === bestOptionId;

                    const card = document.createElement('div');

                    const walletAlerts = AlertManager.getAlertsForWallet(wallet.id, 'withdraw');

                    const hasAlert = walletAlerts.length > 0;

                    

                    card.className = `wallet-card ${isBestOption ? 'best-option' : ''} ${hasAlert ? 'with-alert' : ''}`;

                    card.dataset.walletId = wallet.id;

                    card.dataset.walletType = 'withdraw';

                    

                    let exchangeChangeHtml = '';

                    if (wallet.percentageChange !== null && typeof wallet.percentageChange !== 'undefined') {

                        const arrow = wallet.percentageChange >= 0 ? '▲' : '▼';

                        const changeClass = wallet.percentageChange >= 0 ? 'exchange-up' : 'exchange-down';

                        const percentageText = (Math.abs(wallet.percentageChange * 100)).toFixed(2).replace('.', ',');

                        exchangeChangeHtml = `<span class="exchange-change ${changeClass}">${arrow} ${percentageText}%</span>`;

                    }

                    

                    let commissionText = '';

                    if (wallet.id === 'dolarapp') commissionText = '$3,00 + 3,50%';

                    else if (wallet.id === 'prexuy') commissionText = '$4,88 (fijo)';

                    else if (wallet.id === 'prexarg') commissionText = '0% (sin comisión)';

                    

                    const alertHtml = this._buildAlertHtml(walletAlerts);

                    

                    card.innerHTML = `

                        <button class="wallet-options-btn" aria-label="Opciones para ${wallet.name}"><i class="fas fa-ellipsis-v"></i></button>

                        <div class="wallet-options-menu">

                            <div class="wallet-option-item"><i class="fas fa-download"></i><span>Descargar App</span></div>

                            <div class="wallet-option-item"><i class="fas fa-bell"></i><span>Crear Alerta de precio</span></div>

                        </div>

                        <div class="wallet-header">

                            <div class="wallet-icon ${wallet.iconClass}"><img src="${wallet.icon}" alt="${wallet.name}"></div>

                            <div class="wallet-title">

                                <div class="wallet-name">

                                    ${wallet.name}

                                    ${exchangeChangeHtml}

                                </div>

                            </div>

                        </div>

                        <div class="wallet-detail">

                            <span class="wallet-detail-label">Tasa de cambio (vendes USD):</span>

                            <span class="wallet-detail-value">${Utils.formatExchangeRate(wallet.exchangeRate, 'ARS')}</span>

                        </div>

                        <div class="wallet-detail">

                            <span class="wallet-detail-label">Comisión:</span>

                            <span class="wallet-detail-value">${commissionText}</span>

                        </div>

                        <div class="wallet-detail">

                            <span class="wallet-detail-label">Monto neto en USD:</span>

                            <span class="wallet-detail-value">${Utils.formatCurrency(wallet.netAmount, 'USD')}</span>

                        </div>

                        <div class="net-amount">Recibes: ${Utils.formatCurrency(wallet.totalAmountARS, 'ARS')}</div>

                        ${alertHtml}

                    `;

                    container.appendChild(card);

                });

            },

            

            renderWalletCards(results, bestBuyWalletId, bestSellWalletId) {

                const container = document.getElementById('walletsContainer');

                container.innerHTML = '';

                

                const validResults = results.filter(wallet => wallet.compraRate || wallet.ventaRate);

                

                if (validResults.length === 0) {

                    container.innerHTML = `<div class="status-message"><i class="fas fa-info-circle"></i><h3>No hay datos disponibles</h3><p>Estamos actualizando las tasas de cambio. Por favor, espere un momento.</p></div>`;

                    return;

                }

                

                validResults.sort((a, b) => {

                    const aIsBest = a.id === bestBuyWalletId || a.id === bestSellWalletId;

                    const bIsBest = b.id === bestBuyWalletId || b.id === bestSellWalletId;

                    if (aIsBest && !bIsBest) return -1;

                    if (!aIsBest && bIsBest) return 1;

                    return 0;

                });

                

                validResults.forEach(wallet => {

                    const isBestBuy = wallet.id === bestBuyWalletId;

                    const isBestSell = wallet.id === bestSellWalletId;

                    const card = document.createElement('div');

                    const walletAlerts = AlertManager.getAlertsForWallet(wallet.id, 'general');

                    const hasAlert = walletAlerts.length > 0;

                    

                    card.className = `wallet-card ${(isBestBuy || isBestSell) ? 'best-option' : ''} ${hasAlert ? 'with-alert' : ''}`;

                    card.dataset.walletId = wallet.id;

                    card.dataset.walletType = 'general';

                    

                    let bestOptionsHtml = '';

                    if (isBestBuy) bestOptionsHtml += '<div class="best-option-tag">Mejor para comprar</div>';

                    if (isBestSell) bestOptionsHtml += '<div class="best-option-tag sell">Mejor para vender</div>';

                    if (bestOptionsHtml) bestOptionsHtml = `<div class="best-options">${bestOptionsHtml}</div>`;

                    

                    const alertHtml = this._buildAlertHtml(walletAlerts);

                    

                    const buyChangeHtml = this._buildRateChangeHtml(wallet.buyPercentageChange);

                    const sellChangeHtml = this._buildRateChangeHtml(wallet.sellPercentageChange);



                    card.innerHTML = `

                        ${bestOptionsHtml}

                        <button class="wallet-options-btn" aria-label="Opciones para ${wallet.name}"><i class="fas fa-ellipsis-v"></i></button>

                        <div class="wallet-options-menu">

                            <div class="wallet-option-item"><i class="fas fa-download"></i><span>Descargar App</span></div>

                            <div class="wallet-option-item"><i class="fas fa-bell"></i><span>Crear Alerta de precio</span></div>

                        </div>

                        <div class="wallet-header">

                            <div class="wallet-icon ${wallet.iconClass}"><img src="${wallet.icon}" alt="${wallet.name}"></div>

                            <div class="wallet-title"><div class="wallet-name">${wallet.name}</div></div>

                        </div>

                        <div class="commission-details">

                            <div class="commission-item">

                                <span>Compras USD:</span>

                                <span>${wallet.compraRate ? `1 USD = ${Utils.formatCurrency(wallet.compraRate, 'ARS')}` : 'No disponible'} ${buyChangeHtml}</span>

                            </div>

                            <div class="commission-item">

                                <span>Vendes USD:</span>

                                <span>${wallet.ventaRate ? `1 USD = ${Utils.formatCurrency(wallet.ventaRate, 'ARS')}` : 'No disponible'} ${sellChangeHtml}</span>

                            </div>

                        </div>

                        <div class="wallet-detail">

                            <span class="wallet-detail-label">Actualizado:</span>

                            <span class="wallet-detail-value">${wallet.lastUpdated || 'No disponible'}</span>

                        </div>

                        ${alertHtml}

                    `;

                    container.appendChild(card);

                });

            },

            

            _buildRateChangeHtml(percentageChange) {

                if (percentageChange === null || typeof percentageChange === 'undefined') return '';

                const arrow = percentageChange >= 0 ? '▲' : '▼';

                const changeClass = percentageChange >= 0 ? 'exchange-up' : 'exchange-down';

                const percentageText = (Math.abs(percentageChange * 100)).toFixed(2).replace('.', ',');

                return `<span class="${changeClass}" style="margin-left: 8px;">${arrow} ${percentageText}%</span>`;

            },

            

            setupAmountInputs() {

                const debounceCallback = Utils.debounce(() => {

                    const value = document.getElementById('amountInput').value;

                    if (value === '0,00' || value === '') {

                        currentAmount = 0;

                        document.getElementById('errorMessage').style.display = 'none';

                        CalculationManager.calculateAllResults();

                        return;

                    }

                    const validation = Utils.validateAmount('$' + value);

                    if (validation.error) {

                        document.getElementById('errorMessage').textContent = validation.error;

                        document.getElementById('errorMessage').style.display = 'block';

                    } else {

                        document.getElementById('errorMessage').style.display = 'none';

                        currentAmount = validation.value;

                        CalculationManager.calculateAllResults();

                    }

                }, 300);



                this.setupAmountContainer('amountContainer', 'amountDisplay', 'amountInput', 'USD', debounceCallback);

                this.setupAmountContainer('receiveAmountContainer', 'receiveAmountDisplay', 'receiveAmount', 'USD', Utils.debounce(() => CalculationManager.calculateReceiveMode(), 300));

                this.setupAmountContainer('sendAmountContainer', 'sendAmountDisplay', 'sendAmount', 'USD', Utils.debounce(() => CalculationManager.calculateSendMode(), 300));



                Utils.setupNumericInput(document.getElementById('amountInput'));

                Utils.setupNumericInput(document.getElementById('receiveAmount'));

                Utils.setupNumericInput(document.getElementById('sendAmount'));

            },

            

            setupAmountContainer(containerId, displayId, inputId, currencyCode, callback) {

                const container = document.getElementById(containerId);

                const display = document.getElementById(displayId);

                const input = document.getElementById(inputId);

                

                Utils.setupAmountInput(input, display, currencyCode, 0, callback);

                

                container.addEventListener('click', () => {

                    container.classList.add('active');

                    input.focus();

                });

                input.addEventListener('blur', () => container.classList.remove('active'));

                input.addEventListener('click', (e) => e.stopPropagation());

            }

        };

        

        // ===== DATOS DE LA APLICACIÓN =====

        const withdrawWallets = [

            { id: 'dolarapp', name: 'Dolar App', icon: 'https://raw.githubusercontent.com/Brittleleaf/leafvietcalc.github.io/main/Images/icons/dolar-app.svg', iconClass: 'dolarapp-icon', exchangeRate: 0, visible: true, api: 'https://criptoya.com/api/dolarapp/USDC/ARS/0.1', downloadLink: 'https://play.google.com/store/apps/details?id=com.dolarapp', updateGroup: 'stablecoin' },

            { id: 'prexarg', name: 'Prex ARG', icon: 'https://raw.githubusercontent.com/Brittleleaf/leafvietcalc.github.io/main/Images/icons/prex.svg', iconClass: 'prexarg-icon', exchangeRate: 0, visible: true, downloadLink: 'https://play.google.com/store/apps/details?id=com.prex.card', updateGroup: 'scraping' },

            { id: 'prexuy', name: 'Prex UY', icon: 'https://raw.githubusercontent.com/Brittleleaf/leafvietcalc.github.io/main/Images/icons/prex.svg', iconClass: 'prexuy-icon', exchangeRate: 0, visible: true, downloadLink: 'https://play.google.com/store/apps/details?id=com.prex.card', updateGroup: 'scraping' }

        ];

        

        const wallets = [

            { id: 'uala', name: 'Ualá', icon: 'https://raw.githubusercontent.com/Brittleleaf/leafvietcalc.github.io/main/Images/icons/uala.svg', iconClass: 'uala-icon', compraRate: 0, ventaRate: 0, lastUpdated: '', commissionRate: 0.03, fixedFee: 15, visible: true, scrape: true, downloadLink: 'https://play.google.com/store/apps/details?id=com.ar.uala.wallet', updateGroup: 'scraping' },

            { id: 'lemon', name: 'Lemon Cash', icon: 'https://raw.githubusercontent.com/Brittleleaf/leafvietcalc.github.io/main/Images/icons/lemon.svg', iconClass: 'lemon-icon', compraRate: 0, ventaRate: 0, lastUpdated: '', commissionRate: 0.02, fixedFee: 20, visible: true, api: 'https://criptoya.com/api/lemoncash/USDC/ARS/0.1', downloadLink: 'https://play.google.com/store/apps/details?id=com.lemoncash.me', updateGroup: 'stablecoin' },

            { id: 'santander', name: 'Banco Santander', icon: 'https://raw.githubusercontent.com/Brittleleaf/leafvietcalc.github.io/main/Images/icons/SAN.svg', iconClass: 'santander-icon', compraRate: 0, ventaRate: 0, lastUpdated: '', commissionRate: 0.01, fixedFee: 5, visible: true, api: 'https://criptoya.com/api/bancostodos', downloadLink: 'https://play.google.com/store/apps/details?id=com.santander.appway', updateGroup: 'scraping' },

            { id: 'belo', name: 'Belo', icon: 'https://raw.githubusercontent.com/Brittleleaf/leafvietcalc.github.io/main/Images/icons/belo.svg', iconClass: 'belo-icon', compraRate: 0, ventaRate: 0, lastUpdated: '', commissionRate: 0.015, fixedFee: 8, visible: true, api: 'https://criptoya.com/api/belo/USDC/ARS/0.1', downloadLink: 'https://play.google.com/store/apps/details?id=com.belo.app', updateGroup: 'stablecoin' },

            { id: 'airtm', name: 'Airtm', icon: 'https://raw.githubusercontent.com/Brittleleaf/leafvietcalc.github.io/main/Images/icons/AIRTM.png', iconClass: 'airtm-icon', compraRate: 0, ventaRate: 0, lastUpdated: '', commissionRate: 0.02, fixedFee: 10, visible: true, api: 'https://criptoya.com/api/airtm/USDC/ARS/0.1', downloadLink: 'https://play.google.com/store/apps/details?id=com.airtm.app', updateGroup: 'stablecoin' },

            { id: 'brubank', name: 'Brubank', icon: 'https://raw.githubusercontent.com/Brittleleaf/leafvietcalc.github.io/main/Images/icons/brubank.svg', iconClass: 'brubank-icon', compraRate: 0, ventaRate: 0, lastUpdated: '', commissionRate: 0.01, fixedFee: 5, visible: true, api: 'https://criptoya.com/api/bancostodos', downloadLink: 'https://play.google.com/store/apps/details?id=com.brubank.brubank', updateGroup: 'scraping' },

            { id: 'bna', name: 'Banco Nación', icon: 'https://raw.githubusercontent.com/Brittleleaf/leafvietcalc.github.io/main/Images/icons/banco-nacion.svg', iconClass: 'bna-icon', compraRate: 0, ventaRate: 0, lastUpdated: '', commissionRate: 0.005, fixedFee: 10, visible: true, api: 'https://criptoya.com/api/bancostodos', downloadLink: 'https://www.bna.com.ar/Personas', updateGroup: 'scraping' },

            { id: 'icbc', name: 'ICBC', icon: 'https://raw.githubusercontent.com/Brittleleaf/leafvietcalc.github.io/main/Images/icons/banco-icbc.svg', iconClass: 'icbc-icon', compraRate: 0, ventaRate: 0, lastUpdated: '', commissionRate: 0.015, fixedFee: 8, visible: true, api: 'https://criptoya.com/api/bancostodos', downloadLink: 'https://www.icbc.com.ar/personas', updateGroup: 'scraping' },

            { id: 'mercadopago', name: 'Mercado Pago', icon: 'https://raw.githubusercontent.com/Brittleleaf/leafvietcalc.github.io/main/Images/icons/mercadopago.svg', iconClass: 'mercadopago-icon', compraRate: 0, ventaRate: 0, lastUpdated: '', commissionRate: 0.05, fixedFee: 10, visible: false, api: 'https://criptoya.com/api/bancostodos', downloadLink: 'https://play.google.com/store/apps/details?id=com.mercadopago.wallet', updateGroup: 'scraping' },

            { id: 'paypal', name: 'PayPal', icon: 'https://raw.githubusercontent.com/Brittleleaf/leafvietcalc.github.io/main/Images/icons/PYPL.svg', iconClass: 'paypal-icon', compraRate: 0, ventaRate: 0, lastUpdated: '', commissionRate: 0.054, fixedFee: 0.30, visible: false, downloadLink: 'https://play.google.com/store/apps/details?id=com.paypal.android.p2pmobile', updateGroup: 'scraping' },

            { id: 'naranjax', name: 'Naranja X', icon: 'https://raw.githubusercontent.com/Brittleleaf/leafvietcalc.github.io/main/Images/icons/naranja-x.svg', iconClass: 'naranjax-icon', compraRate: 0, ventaRate: 0, lastUpdated: '', commissionRate: 0.04, fixedFee: 12, visible: false, api: 'https://criptoya.com/api/bancostodos', downloadLink: 'https://play.google.com/store/apps/details?id=com.bancor.naranjax', updateGroup: 'scraping' },

            { id: 'galicia', name: 'Banco Galicia', icon: 'https://raw.githubusercontent.com/Brittleleaf/leafvietcalc.github.io/main/Images/icons/banco-galicia.svg', iconClass: 'galicia-icon', compraRate: 0, ventaRate: 0, lastUpdated: '', commissionRate: 0.02, fixedFee: 12, visible: false, api: 'https://criptoya.com/api/bancostodos', downloadLink: 'https://www.bancogalicia.com/banca/privada/personas', updateGroup: 'scraping' }

        ];



        const paypalConfig = {

            receive: { commissionRate: 0.054, fixedFee: 0.30 },

            send: { commissionRate: 0.054, fixedFee: 0.30 }

        };

        

        // ===== ESTADO DE LA APLICACIÓN =====

        let currentAmount = 0;

        let currentMode = 'receive';

        let currentCurrency = 'ARS';

        let userNickname = 'Usuario';

        let currentWalletForAlert = null;

        let editingAlertId = null;

        

        // ===== INICIALIZACIÓN (FLUJO CORREGIDO) =====

        document.addEventListener('DOMContentLoaded', async () => {

            // 1. Inicializar todos los módulos

            RateManager.init();

            AlertManager.init();

            NotificationManager.init();

            PersonalDataManager.init();

            UIManager.init();

            UIManager.setupAmountInputs();

            

            // 2. Hidratar los arrays de billeteras con los datos del caché

            RateManager.applyCachedRatesToWallets();

            

            // 3. Renderizar la UI inmediatamente con los datos cacheados

            CalculationManager.calculateAllResults();

            

            // 4. Manejar la actualización de datos de forma inteligente

            if (!RateManager.firstLoadDone) {

                // Si es la primera vez que el usuario abre la app, hacer la carga completa.

                await RateManager.initialLoad();

            } else {

                // Si ya hay datos, iniciar los intervalos y forzar una actualización en segundo plano.

                RateManager.startAutoUpdate();

                RateManager.refreshAllRates(); // No es necesario esperar (await) a que termine

            }

            

            // 5. Configurar verificaciones periódicas

            setInterval(() => AlertManager.checkAlerts(), 5 * 60 * 1000); // Cada 5 minutos

            setInterval(() => NotificationManager.cleanOldNotifications(), 10 * 60 * 1000); // Cada 10 minutos

        });

    </script>

</body>

</html>
